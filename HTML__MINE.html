<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Papacosmas Niko" />


<title>Capstone HarvardX - Project MovieLens</title>
<!-- Material Design fonts -->
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<script src="HTML__MINE_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="HTML__MINE_files/bootstrap-3.3.6/css/bootstrap.min.css" rel="stylesheet" />
<script src="HTML__MINE_files/bootstrap-3.3.6/js/bootstrap.min.js"></script>
<script src="HTML__MINE_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<script src="HTML__MINE_files/navigation-1.1/tabsets.js"></script>
<script src="HTML__MINE_files/navigation-1.1/codefolding.js"></script>
<link href="HTML__MINE_files/magnific-popup-1.1.0/magnific-popup.css" rel="stylesheet" />
<script src="HTML__MINE_files/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script>
<link href="HTML__MINE_files/bootstrap_material-0.1/bootstrap-material-design.min.css" rel="stylesheet" />
<link href="HTML__MINE_files/bootstrap_material-0.1/ripples.min.css" rel="stylesheet" />
<script src="HTML__MINE_files/bootstrap_material-0.1/material.min.js"></script>
<script src="HTML__MINE_files/bootstrap_material-0.1/ripples.min.js"></script>
<link href="HTML__MINE_files/material-0.1/material.css" rel="stylesheet" />
<script src="HTML__MINE_files/material-0.1/material.js"></script>
<script src="HTML__MINE_files/kePrint-0.0.1/kePrint.js"></script>
<script src="HTML__MINE_files/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="HTML__MINE_files/plotly-binding-4.9.0/plotly.js"></script>
<script src="HTML__MINE_files/typedarray-0.1/typedarray.min.js"></script>
<link href="HTML__MINE_files/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="HTML__MINE_files/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="HTML__MINE_files/plotly-htmlwidgets-css-1.46.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="HTML__MINE_files/plotly-main-1.46.1/plotly-latest.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>


<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

</head>

<body>

<div class="header-panel shadow z-2">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-3">
        <div id="header">
    <h1 class="title">Capstone HarvardX - Project MovieLens</h1>
                <h4 class="author">Papacosmas Niko</h4>
                <h4 class="date">May 2019</h4>
        </div>
    </div>
</div>
</div>
</div>


<div class="container-fluid main-container">
    <div class="row">
      <nav class="col-xs-3 menu">
        <div id="toc">
        <ul>
        <li><a href="#abstract">Abstract</a></li>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#data-observation">Data Observation</a></li>
        <li><a href="#matrix-factorization-with-parallel-stochastic-gradient-descent">Matrix Factorization with parallel stochastic gradient descent</a></li>
        <li><a href="#h2o-machine-learning-training-build-and-validating-part">H2o Machine learning training, build and validating part</a></li>
        <li><a href="#h2o-automl">H2O AutoML</a></li>
        <li><a href="#h2o-generalized-linear-models-glm">H2o Generalized Linear Models (GLM)</a></li>
        <li><a href="#h2o---gradient-boosting-machine-model">H2o - Gradient Boosting Machine model</a></li>
        <li><a href="#h2o-distributed-random-forest">H2o Distributed Random Forest</a></li>
        <li><a href="#h2o-stacked-ensembles">H2o Stacked Ensembles</a></li>
        <li><a href="#root-mean-squared-error-of-all-models">Root mean squared error of all models</a></li>
        <li><a href="#conclusions">Conclusions</a></li>
        <li><a href="#recommendations">Recommendations</a></li>
        </ul>
        </div>
        
        
        
      </nav>
     <div class="pages col-xs-9">
     <div class="row">
       <div class="col-xs-10">



<div id="abstract" class="section level1">
<h1>Abstract</h1>
<p><br> <br></p>
<p>Recommender systems algorithms are applied into industry on various business domains. The most popular are: <br> <br> -The <strong>movie recommendations</strong> like the one used by Netflix.</p>
<p>-And the <strong>(related items recommendations)</strong> during online purchases. <br> <br> There are 2 types of recommender systems:</p>
<p>-<strong>Content Filtering</strong> : Based on the description of the item also called meta data or side information</p>
<p>-And <strong>Collaborative Filtering</strong>: Are calculating the similarity measures of the target ITEMS and finding the minimum (Euclidean distance, or Cosine distance, or other metric, it depends on the algorithm). This is done by filtering the interests of a user, by collecting preferences from many users <em>(collaborating)</em>. <br> <br> <strong>Matrix factorization with parallel stochastic gradient descent</strong>, is an effective algorithm used to create a recommender system.The approach is to approximate the rating matrix: <br> <br> <span class="math inline">\(R_{m\times n}\)</span> by the product of two matrixes containing lower dimensions, <span class="math inline">\(P_{k\times m}\)</span> and <span class="math inline">\(Q_{k\times n}\)</span>, in a way that <span class="math display">\[R\approx P^\prime Q\]</span> <br> For Ex. <span class="math inline">\(p_u\)</span> is the <span class="math inline">\(u\)</span>-th column of <span class="math inline">\(P\)</span>, and <span class="math inline">\(q_v\)</span> is the <span class="math inline">\(v\)</span>-th column of <span class="math inline">\(Q\)</span>, then the movie rating placed by the user <span class="math inline">\(u\)</span> on the item <span class="math inline">\(v\)</span> would be predicted as <span class="math inline">\(p^\prime_u q_v\)</span>.</p>
<p><br> A usual equation for the <span class="math inline">\(P\)</span> and th <span class="math inline">\(Q\)</span> is given by the below optimization problem : <br> <br></p>
<p><span class="math display">\[\min_{P,Q} \sum_{(u,v)\in R} \left[f(p_u,q_v;r_{u,v})+\mu_P||p_u||_1+\mu_Q||q_v||_1+\frac{\lambda_P}{2}
                                     ||p_u||_2^2+\frac{\lambda_Q}{2} ||q_v||_2^2\right]\]</span> <br> <br> where the <span class="math inline">\((u,v)\)</span> are the locations of the real entries in the <span class="math inline">\(R\)</span>, <span class="math inline">\(r_{u,v}\)</span> is the real rating, <span class="math inline">\(f\)</span> is the loss function, and <span class="math inline">\(\mu_P,\mu_Q,\lambda_P,\lambda_Q\)</span> are the usual penalization parameters used by many algorithms to avoid overfitting. <br> <br> The procedure of solving the matrix <span class="math inline">\(P\)</span> and <span class="math inline">\(Q\)</span> is the model training, and the selection of choosing penalization parameters is the hyper parameters tuning. After obtaining the <span class="math inline">\(P\)</span> and the <span class="math inline">\(Q\)</span>, <br> <br> we can then predict : <br> <br> <span class="math inline">\(\hat{R}_{u,v}=p^\prime_u q_v\)</span>. <br> <br> Many thanks to Yixuan Qiu from Carnegie Mellon University Source: <a href="https://github.com/yixuan/">Yixuan</a> <br></p>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p><br> <br> The purpose of this R project is to create a <strong>rating recommender system through machine learning training.</strong> That recommender system will be able to predict a users rating into a new movie. Or the user preference for a movie. <br> <br> The most famous recommender training event was the competition launched by <strong>Netflix with one milion dollar price.</strong> I will use the 10M (millions) rows rating dataset named MovieLens created by the University of Minnesota. It was released at 1/2009 so our newest movies are until 2008. In order to find a pattern and behavior of the data, the data sets where “enhanced” by many new features (dimensions). As validation of the models i wil use RMSE (regression approach). During the project more explanation is given. <br> <br> Many algorithms and data transformations where applied in order to achieve the lowest RMSE. Such us:</p>
<p>-<strong>Matrix Factorization with parallel stochastic gradient descent</strong> -<strong>H2o stacked ensembles of (GBM,GLM,DRF,NN)</strong> -<strong>H2o Deep Learning (Neural Networks)</strong> -<strong>H2o Gradient Boosting Machine (GBM)</strong> -<strong>H2o Auto ML</strong></p>
<p><br> <br> <em>collaborative filtering</em> underlying assumption is that if a person X has the same opinion as a person Y then the recommendation system should be based on preferences of person Y (similarity). I will enhance the collaborative filtering with the application of:</p>
<p>-<strong>Matrix Factorization with parallel stochastic gradient descent algorithms</strong>. MF is a class of collaborative filtering algorithms used in recommender systems. Matrix factorization algorithms work by <strong>decomposing the </strong> <strong>user-item interaction matrix into the product of two loir dimensionality rectangular matrices</strong>.</p>
<p>This family of methods became <strong>widely known during the Netflix prize challenge</strong> due to its effectiveness as reported by Simon Funk in his 2006 blog where he shared his findings with the research community.</p>
<p>[recosystem](<a href="https://en.wikipedia.org/wiki/Matrix_factorization_(recommender_systems)" class="uri">https://en.wikipedia.org/wiki/Matrix_factorization_(recommender_systems)</a></p>
<p>We will apply <strong>Matrix Factorization with parallel stochastic gradient descent</strong>. With the help of <em>“recosystem”</em> package it is an R wrapper of the LIBMF library which creates a Recommender System by Using Parallel Matrix Factorization.</p>
<p>-The main task of recommender system is to predict unknown entries in the rating matrix based on observed values.</p>
<p>More info on the recosystem package and the techniques</p>
<p><a href="https://cran.r-project.org/ib/packages/recosystem/vignettes/introduction.html">recosystem</a></p>
<p><br> <code>Loading of the required libraries</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(tidyverse)
<span class="kw">require</span>(caret)
<span class="kw">require</span>(rmarkdown)
<span class="kw">require</span>(plotly)
<span class="kw">require</span>(rpart)
<span class="kw">require</span>(lattice)
<span class="kw">require</span>(ggthemes)
<span class="kw">require</span>(GGally)
<span class="kw">require</span>(knitr)
<span class="kw">require</span>(tidyr)
<span class="kw">require</span>(wordcloud)
<span class="kw">require</span>(kableExtra)
<span class="kw">require</span>(RColorBrewer)
<span class="kw">require</span>(dplyr)
<span class="kw">require</span>(ggplot2)
<span class="kw">require</span>(lubridate)
<span class="kw">require</span>(h2o)
<span class="kw">require</span>(stringr)
<span class="kw">require</span>(formatR)
<span class="kw">require</span>(recosystem)
<span class="kw">require</span>(knitr)</code></pre></div>
</div>
<div id="data-observation" class="section level1">
<h1>Data Observation</h1>
<p><br> <br> <code>Data structure of the edx (training set)</code></p>
<pre><code>Observations: 9,000,055
Variables: 6
$ userId    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1...
$ movieId   &lt;dbl&gt; 122, 185, 292, 316, 329, 355, 356, 362, 364, 370, 37...
$ rating    &lt;dbl&gt; 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5...
$ timestamp &lt;int&gt; 838985046, 838983525, 838983421, 838983392, 83898339...
$ title     &lt;chr&gt; &quot;Boomerang (1992)&quot;, &quot;Net, The (1995)&quot;, &quot;Outbreak (19...
$ genres    &lt;chr&gt; &quot;Comedy|Romance&quot;, &quot;Action|Crime|Thriller&quot;, &quot;Action|D...</code></pre>
<p>Its class’data.frame’with : -9000047 obs (rows) -6 variables (features) <br> <br> The same movie entry might belong to more than one genre. Every discrete rating is on a discrete row. <br> <br> <code>First entries of the edx (training set)</code></p>
<pre><code>  userId movieId rating timestamp                         title
1      1     122      5 838985046              Boomerang (1992)
2      1     185      5 838983525               Net, The (1995)
4      1     292      5 838983421               Outbreak (1995)
5      1     316      5 838983392               Stargate (1994)
6      1     329      5 838983392 Star Trek: Generations (1994)
7      1     355      5 838984474       Flintstones, The (1994)
                         genres
1                Comedy|Romance
2         Action|Crime|Thriller
4  Action|Drama|Sci-Fi|Thriller
5       Action|Adventure|Sci-Fi
6 Action|Adventure|Drama|Sci-Fi
7       Children|Comedy|Fantasy</code></pre>
<p><br> <br> It looks we have to transform the timestamp which represents the (rating date), since the release date is inside the movie (title) column. <br> <br> We will extract the release date from the movie title. And we will create a new matrix with more dimensions, containing every movie genre separately as factor. <br> <br> <code>Summary of the edx (training set)</code></p>
<pre><code>     userId         movieId          rating        timestamp        
 Min.   :    1   Min.   :    1   Min.   :0.500   Min.   :7.897e+08  
 1st Qu.:18124   1st Qu.:  648   1st Qu.:3.000   1st Qu.:9.468e+08  
 Median :35738   Median : 1834   Median :4.000   Median :1.035e+09  
 Mean   :35870   Mean   : 4122   Mean   :3.512   Mean   :1.033e+09  
 3rd Qu.:53607   3rd Qu.: 3626   3rd Qu.:4.000   3rd Qu.:1.127e+09  
 Max.   :71567   Max.   :65133   Max.   :5.000   Max.   :1.231e+09  
    title              genres         
 Length:9000055     Length:9000055    
 Class :character   Class :character  
 Mode  :character   Mode  :character  
                                      
                                      
                                      </code></pre>
<p><br> <br> The rating mean shows that users <strong>are rating above the average rating (3.512)</strong> <em>right skewed</em> <br> <br> -<strong>Rating (our dependent variable y) has 10 continuous values from 0 until 5.</strong> Its row has one given rating by one user for one movie. <br> <br> -Rating is our dependent (target variable) y<br />
-userId, movieId, timestamp (date&amp;time) are: quantitative - Discrete unique numbers.<br />
-Title and genres are: qualitative and not unique.<br />
<br> <br> <code>Data structure of the validation (testing set)</code></p>
<pre><code>Observations: 999,999
Variables: 6
$ userId    &lt;int&gt; 1, 1, 1, 2, 2, 2, 3, 3, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5...
$ movieId   &lt;dbl&gt; 231, 480, 586, 151, 858, 1544, 590, 4995, 34, 432, 4...
$ rating    &lt;dbl&gt; 5.0, 5.0, 5.0, 3.0, 2.0, 3.0, 3.5, 4.5, 5.0, 3.0, 3....
$ timestamp &lt;int&gt; 838983392, 838983653, 838984068, 868246450, 86824564...
$ title     &lt;chr&gt; &quot;Dumb &amp; Dumber (1994)&quot;, &quot;Jurassic Park (1993)&quot;, &quot;Hom...
$ genres    &lt;chr&gt; &quot;Comedy&quot;, &quot;Action|Adventure|Sci-Fi|Thriller&quot;, &quot;Child...</code></pre>
<p><br> <br> Its class ‘data.frame’: With 999999 obs. of 6 variables: Its exactly the 10% of our training set. And has the same 6 features <br> <br> <code>First entries of the validation (testing set)</code></p>
<pre><code>  userId movieId rating timestamp
1      1     231      5 838983392
2      1     480      5 838983653
3      1     586      5 838984068
4      2     151      3 868246450
5      2     858      2 868245645
6      2    1544      3 868245920
                                                    title
1                                    Dumb &amp; Dumber (1994)
2                                    Jurassic Park (1993)
3                                       Home Alone (1990)
4                                          Rob Roy (1995)
5                                   Godfather, The (1972)
6 Lost World: Jurassic Park, The (Jurassic Park 2) (1997)
                                   genres
1                                  Comedy
2        Action|Adventure|Sci-Fi|Thriller
3                         Children|Comedy
4                Action|Drama|Romance|War
5                             Crime|Drama
6 Action|Adventure|Horror|Sci-Fi|Thriller</code></pre>
<p>Same as our training set. So we will perform the same data transformation on both training and test datasets. we mentioned earlier we could <strong>add features in our datasets in order to analyse for</strong> correlations,** and if they exist they would help our ML models. By adding a feature**of release year and year rated. So we will create 2 new dataframes with that features for train set and test sets. <br> <br> <code>We will transform timestamp to year rated, and extract the premier data from the movie title and add it as a separate feature.</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edx &lt;-<span class="st"> </span>edx <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">timestamp =</span> <span class="kw">as.POSIXct</span>(timestamp, <span class="dt">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>, 
    <span class="dt">tz =</span> <span class="st">&quot;GMT&quot;</span>))
edx<span class="op">$</span>timestamp &lt;-<span class="st"> </span><span class="kw">format</span>(edx<span class="op">$</span>timestamp, <span class="st">&quot;%Y&quot;</span>)

<span class="kw">colnames</span>(edx)</code></pre></div>
<pre><code>[1] &quot;userId&quot;    &quot;movieId&quot;   &quot;rating&quot;    &quot;timestamp&quot; &quot;title&quot;     &quot;genres&quot;   </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(edx)[<span class="kw">names</span>(edx) <span class="op">==</span><span class="st"> &quot;timestamp&quot;</span>] &lt;-<span class="st"> &quot;year_rated&quot;</span>

releaseyear &lt;-<span class="st"> </span>stringi<span class="op">::</span><span class="kw">stri_extract</span>(edx<span class="op">$</span>title, <span class="dt">regex =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">d{4})&quot;</span>, <span class="dt">comments =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">as.numeric</span>()


edx &lt;-<span class="st"> </span>edx <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">release_year =</span> releaseyear)



validation &lt;-<span class="st"> </span>validation <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">timestamp =</span> <span class="kw">as.POSIXct</span>(validation<span class="op">$</span>timestamp, 
    <span class="dt">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;GMT&quot;</span>))
validation<span class="op">$</span>timestamp &lt;-<span class="st"> </span><span class="kw">format</span>(validation<span class="op">$</span>timestamp, <span class="st">&quot;%Y&quot;</span>)

<span class="kw">colnames</span>(validation)</code></pre></div>
<pre><code>[1] &quot;userId&quot;    &quot;movieId&quot;   &quot;rating&quot;    &quot;timestamp&quot; &quot;title&quot;     &quot;genres&quot;   </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(validation)[<span class="kw">names</span>(validation) <span class="op">==</span><span class="st"> &quot;timestamp&quot;</span>] &lt;-<span class="st"> &quot;year_rated&quot;</span>

releaseyear2 &lt;-<span class="st"> </span>stringi<span class="op">::</span><span class="kw">stri_extract</span>(validation<span class="op">$</span>title, <span class="dt">regex =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">d{4})&quot;</span>, 
    <span class="dt">comments =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>()


validation &lt;-<span class="st"> </span>validation <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">release_year =</span> releaseyear2)</code></pre></div>
<p><code>Check the data sets for consistency</code></p>
<pre><code>  userId movieId rating year_rated                         title
1      1     122      5       1996              Boomerang (1992)
2      1     185      5       1996               Net, The (1995)
3      1     292      5       1996               Outbreak (1995)
4      1     316      5       1996               Stargate (1994)
5      1     329      5       1996 Star Trek: Generations (1994)
6      1     355      5       1996       Flintstones, The (1994)
                         genres release_year
1                Comedy|Romance         1992
2         Action|Crime|Thriller         1995
3  Action|Drama|Sci-Fi|Thriller         1995
4       Action|Adventure|Sci-Fi         1994
5 Action|Adventure|Drama|Sci-Fi         1994
6       Children|Comedy|Fantasy         1994</code></pre>
<pre><code>  userId movieId rating year_rated
1      1     231      5       1996
2      1     480      5       1996
3      1     586      5       1996
4      2     151      3       1997
5      2     858      2       1997
6      2    1544      3       1997
                                                    title
1                                    Dumb &amp; Dumber (1994)
2                                    Jurassic Park (1993)
3                                       Home Alone (1990)
4                                          Rob Roy (1995)
5                                   Godfather, The (1972)
6 Lost World: Jurassic Park, The (Jurassic Park 2) (1997)
                                   genres release_year
1                                  Comedy         1994
2        Action|Adventure|Sci-Fi|Thriller         1993
3                         Children|Comedy         1990
4                Action|Drama|Romance|War         1995
5                             Crime|Drama         1972
6 Action|Adventure|Horror|Sci-Fi|Thriller         1997</code></pre>
<p><code>Display the distinct number of users and distinct number of movies in our train set</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edx <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">distinct_users =</span> <span class="kw">n_distinct</span>(userId), <span class="dt">distinct_movies =</span> <span class="kw">n_distinct</span>(movieId))</code></pre></div>
<pre><code>  distinct_users distinct_movies
1          69878           10677</code></pre>
<p><code>We create and display a new df with useful  metrics in order to understand better our dataset and identify  outliers.</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edx_movies_metrics &lt;-<span class="st"> </span>edx <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate_rows</span>(genres, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">|&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(genres) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">Ratings_perGenre_Sum =</span> <span class="kw">n</span>(), <span class="dt">Ratings_perGenre_Mean =</span> <span class="kw">mean</span>(rating), 
        <span class="dt">Movies_perGenre_Sum =</span> <span class="kw">n_distinct</span>(movieId), <span class="dt">Users_perGenre_Sum =</span> <span class="kw">n_distinct</span>(userId))
edx_movies_metrics</code></pre></div>
<pre><code># A tibble: 20 x 5
   genres Ratings_perGenr~ Ratings_perGenr~ Movies_perGenre~
   &lt;chr&gt;             &lt;int&gt;            &lt;dbl&gt;            &lt;int&gt;
 1 (no g~                7             3.64                1
 2 Action          2560545             3.42             1473
 3 Adven~          1908892             3.49             1025
 4 Anima~           467168             3.60              286
 5 Child~           737994             3.42              528
 6 Comedy          3540930             3.44             3703
 7 Crime           1327715             3.67             1117
 8 Docum~            93066             3.78              481
 9 Drama           3910127             3.67             5336
10 Fanta~           925637             3.50              543
11 Film-~           118541             4.01              148
12 Horror           691485             3.27             1013
13 IMAX               8181             3.77               29
14 Music~           433080             3.56              436
15 Myste~           568332             3.68              509
16 Roman~          1712100             3.55             1685
17 Sci-Fi          1341183             3.40              754
18 Thril~          2325899             3.51             1705
19 War              511147             3.78              510
20 Weste~           189394             3.56              275
# ... with 1 more variable: Users_perGenre_Sum &lt;int&gt;</code></pre>
<p>We observe that the rating mean is not rounded so we will fix it. Also we identify in our new edx movies metrics df that there is one movie without genres. <br/> We will treat it as an outlier and delete it from all our datasets, since it doesnt add any value. We also have 19 distinct genres.<br />
<br/> <code>Display the genres with the most rated movies (not distinct movies)</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edx_movies_metrics<span class="op">$</span>Ratings_perGenre_Mean &lt;-<span class="st"> </span><span class="kw">round</span>(edx_movies_metrics<span class="op">$</span>Ratings_perGenre_Mean, 
    <span class="dt">digits =</span> <span class="dv">2</span>)

edx_movies_metrics[<span class="kw">order</span>(<span class="op">-</span>edx_movies_metrics<span class="op">$</span>Movies_perGenre_Sum), ]</code></pre></div>
<pre><code># A tibble: 20 x 5
   genres Ratings_perGenr~ Ratings_perGenr~ Movies_perGenre~
   &lt;chr&gt;             &lt;int&gt;            &lt;dbl&gt;            &lt;int&gt;
 1 Drama           3910127             3.67             5336
 2 Comedy          3540930             3.44             3703
 3 Thril~          2325899             3.51             1705
 4 Roman~          1712100             3.55             1685
 5 Action          2560545             3.42             1473
 6 Crime           1327715             3.67             1117
 7 Adven~          1908892             3.49             1025
 8 Horror           691485             3.27             1013
 9 Sci-Fi          1341183             3.4               754
10 Fanta~           925637             3.5               543
11 Child~           737994             3.42              528
12 War              511147             3.78              510
13 Myste~           568332             3.68              509
14 Docum~            93066             3.78              481
15 Music~           433080             3.56              436
16 Anima~           467168             3.6               286
17 Weste~           189394             3.56              275
18 Film-~           118541             4.01              148
19 IMAX               8181             3.77               29
20 (no g~                7             3.64                1
# ... with 1 more variable: Users_perGenre_Sum &lt;int&gt;</code></pre>
<p><strong>We can observe that most movies are in the above genres</strong> <br/> <em>(Reminder)</em> those are not distinct movies. Because as we observed earlier one movie might belong to more than one genre</p>
<p><code>Display of the genres - with the most distinct ratings</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edx_movies_metrics[<span class="kw">order</span>(<span class="op">-</span>edx_movies_metrics<span class="op">$</span>Ratings_perGenre_Sum), ]</code></pre></div>
<pre><code># A tibble: 20 x 5
   genres Ratings_perGenr~ Ratings_perGenr~ Movies_perGenre~
   &lt;chr&gt;             &lt;int&gt;            &lt;dbl&gt;            &lt;int&gt;
 1 Drama           3910127             3.67             5336
 2 Comedy          3540930             3.44             3703
 3 Action          2560545             3.42             1473
 4 Thril~          2325899             3.51             1705
 5 Adven~          1908892             3.49             1025
 6 Roman~          1712100             3.55             1685
 7 Sci-Fi          1341183             3.4               754
 8 Crime           1327715             3.67             1117
 9 Fanta~           925637             3.5               543
10 Child~           737994             3.42              528
11 Horror           691485             3.27             1013
12 Myste~           568332             3.68              509
13 War              511147             3.78              510
14 Anima~           467168             3.6               286
15 Music~           433080             3.56              436
16 Weste~           189394             3.56              275
17 Film-~           118541             4.01              148
18 Docum~            93066             3.78              481
19 IMAX               8181             3.77               29
20 (no g~                7             3.64                1
# ... with 1 more variable: Users_perGenre_Sum &lt;int&gt;</code></pre>
<p><strong>Here we observed that the top 3 genres with the most ratings are</strong></p>
<p><strong>-Drama</strong><br />
<strong>-Comedy and</strong><br />
<strong>-Action</strong></p>
<p><strong>Some genres have exponential low sum of ratings so probably they will be also treated as outliers in the data frame that we will create with all genres as factors</strong><br />
<br/> <code>Display of ratings mean - per genre</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edx_movies_metrics[<span class="kw">order</span>(<span class="op">-</span>edx_movies_metrics<span class="op">$</span>Ratings_perGenre_Mean), ]</code></pre></div>
<pre><code># A tibble: 20 x 5
   genres Ratings_perGenr~ Ratings_perGenr~ Movies_perGenre~
   &lt;chr&gt;             &lt;int&gt;            &lt;dbl&gt;            &lt;int&gt;
 1 Film-~           118541             4.01              148
 2 Docum~            93066             3.78              481
 3 War              511147             3.78              510
 4 IMAX               8181             3.77               29
 5 Myste~           568332             3.68              509
 6 Crime           1327715             3.67             1117
 7 Drama           3910127             3.67             5336
 8 (no g~                7             3.64                1
 9 Anima~           467168             3.6               286
10 Music~           433080             3.56              436
11 Weste~           189394             3.56              275
12 Roman~          1712100             3.55             1685
13 Thril~          2325899             3.51             1705
14 Fanta~           925637             3.5               543
15 Adven~          1908892             3.49             1025
16 Comedy          3540930             3.44             3703
17 Action          2560545             3.42             1473
18 Child~           737994             3.42              528
19 Sci-Fi          1341183             3.4               754
20 Horror           691485             3.27             1013
# ... with 1 more variable: Users_perGenre_Sum &lt;int&gt;</code></pre>
<p><strong>Here we can observe that genres with low sum of ratings have higher rating mean. This is one more</strong> <strong>indicator that should be treated as outliers.</strong> Also movies with low sum of ratings will be removed from the training set for the same reasons</p>
<p><code>We create also for our training set a metrics df</code> <br/></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">validation_movies_metrics &lt;-<span class="st"> </span>validation <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate_rows</span>(genres, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">|&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(genres) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">Ratings_perGenre_Sum =</span> <span class="kw">n</span>(), <span class="dt">Ratings_perGenre_Mean =</span> <span class="kw">mean</span>(rating), 
    <span class="dt">Movies_perGenre_Sum =</span> <span class="kw">n_distinct</span>(movieId), <span class="dt">Users_perGenre_Sum =</span> <span class="kw">n_distinct</span>(userId))



validation_movies_metrics<span class="op">$</span>Ratings_perGenre_Mean &lt;-<span class="st"> </span><span class="kw">round</span>(validation_movies_metrics<span class="op">$</span>Ratings_perGenre_Mean, 
    <span class="dt">digits =</span> <span class="dv">2</span>)


validation_movies_metrics &lt;-<span class="st"> </span><span class="kw">subset</span>(validation_movies_metrics, genres <span class="op">!=</span><span class="st"> &quot;(no genres listed)&quot;</span>)</code></pre></div>
<p><code>We create a ratings distribution df</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ratings_distribution &lt;-<span class="st"> </span>edx <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(rating) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">ratings_distribution_sum =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(ratings_distribution_sum))</code></pre></div>
<code>Display of the ratings distribution</code>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
rating
</th>
<th style="text-align:right;">
ratings_distribution_sum
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
2588430
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
2121240
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
1390114
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.5
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
791624
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
2.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
711422
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.5
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
526736
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
1.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
345679
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
2.5
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
333010
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
1.5
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
106426
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
0.5
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
85374
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border: 0;" colspan="100%">
<span style="font-style: italic;">Note: </span> <sup></sup> Ratings distribution
</td>
</tr>
</tfoot>
</table>
<p><code>Interactive histogram of the ratings distribution</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(edx, <span class="kw">aes</span>(rating, <span class="dt">fill =</span> <span class="kw">cut</span>(rating, <span class="dv">100</span>))) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, 
    <span class="dt">binwidth =</span> <span class="fl">0.2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="fl">0.5</span>, <span class="dv">5</span>, <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> ratings_mean, 
    <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Distribution of ratings&quot;</span>, 
    <span class="dt">x =</span> <span class="st">&quot;Ratings Scale&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Sum Of Rating&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>), 
    <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">11</span>, <span class="dt">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">theme_solarized</span>(<span class="dt">light =</span> <span class="ot">FALSE</span>)

<span class="kw">ggplotly</span>(p1)</code></pre></div>
<div id="htmlwidget-c8e47b50ca0c7c3f952a" style="width:80%;height:576px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-c8e47b50ca0c7c3f952a">{"x":{"data":[{"orientation":"v","width":[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.199999999999999,0.2,0.2,0.2,0.199999999999999,0.2,0.199999999999999,0.2,0.2,0.199999999999999,0.200000000000001,0.199999999999999,0.199999999999999,0.199999999999999,0.199999999999999],"base":[0,0,345679,0,106426,0,0,711422,0,333010,0,0,2121240,0,791624,0,0,2588430,0,526736,0,0,1390114],"x":[0.6,0.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5],"y":[85374,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"text":["count:   85374<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]","count:       0<br />rating: 0.5<br />cut(rating, 100): (0.495,0.545]"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,255,1)"}},"name":"(0.495,0.545]","legendgroup":"(0.495,0.545]","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.199999999999999,0.2,0.2,0.2,0.199999999999999,0.2,0.199999999999999,0.2,0.2,0.199999999999999,0.200000000000001,0.199999999999999,0.199999999999999,0.199999999999999,0.199999999999999],"base":[0,0,0,0,106426,0,0,711422,0,333010,0,0,2121240,0,791624,0,0,2588430,0,526736,0,0,1390114],"x":[0.6,0.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5],"y":[0,0,345679,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"text":["count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:  345679<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]","count:       0<br />rating: 1.0<br />cut(rating, 100): (0.995,1.04]"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(216,144,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,255,1)"}},"name":"(0.995,1.04]","legendgroup":"(0.995,1.04]","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.199999999999999,0.2,0.2,0.2,0.199999999999999,0.2,0.199999999999999,0.2,0.2,0.199999999999999,0.200000000000001,0.199999999999999,0.199999999999999,0.199999999999999,0.199999999999999],"base":[0,0,0,0,0,0,0,711422,0,333010,0,0,2121240,0,791624,0,0,2588430,0,526736,0,0,1390114],"x":[0.6,0.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5],"y":[0,0,0,0,106426,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"text":["count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:  106426<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]","count:       0<br />rating: 1.5<br />cut(rating, 100): (1.49,1.53]"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(163,165,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,255,1)"}},"name":"(1.49,1.53]","legendgroup":"(1.49,1.53]","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.199999999999999,0.2,0.2,0.2,0.199999999999999,0.2,0.199999999999999,0.2,0.2,0.199999999999999,0.200000000000001,0.199999999999999,0.199999999999999,0.199999999999999,0.199999999999999],"base":[0,0,0,0,0,0,0,0,0,333010,0,0,2121240,0,791624,0,0,2588430,0,526736,0,0,1390114],"x":[0.6,0.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5],"y":[0,0,0,0,0,0,0,711422,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"text":["count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:  711422<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]","count:       0<br />rating: 2.0<br />cut(rating, 100): (1.98,2.03]"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(57,182,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,255,1)"}},"name":"(1.98,2.03]","legendgroup":"(1.98,2.03]","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.199999999999999,0.2,0.2,0.2,0.199999999999999,0.2,0.199999999999999,0.2,0.2,0.199999999999999,0.200000000000001,0.199999999999999,0.199999999999999,0.199999999999999,0.199999999999999],"base":[0,0,0,0,0,0,0,0,0,0,0,0,2121240,0,791624,0,0,2588430,0,526736,0,0,1390114],"x":[0.6,0.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5],"y":[0,0,0,0,0,0,0,0,0,333010,0,0,0,0,0,0,0,0,0,0,0,0,0],"text":["count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:  333010<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]","count:       0<br />rating: 2.5<br />cut(rating, 100): (2.48,2.52]"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(0,191,125,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,255,1)"}},"name":"(2.48,2.52]","legendgroup":"(2.48,2.52]","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.199999999999999,0.2,0.2,0.2,0.199999999999999,0.2,0.199999999999999,0.2,0.2,0.199999999999999,0.200000000000001,0.199999999999999,0.199999999999999,0.199999999999999,0.199999999999999],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,791624,0,0,2588430,0,526736,0,0,1390114],"x":[0.6,0.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5],"y":[0,0,0,0,0,0,0,0,0,0,0,0,2121240,0,0,0,0,0,0,0,0,0,0],"text":["count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count: 2121240<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]","count:       0<br />rating: 3.0<br />cut(rating, 100): (2.98,3.02]"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,255,1)"}},"name":"(2.98,3.02]","legendgroup":"(2.98,3.02]","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.199999999999999,0.2,0.2,0.2,0.199999999999999,0.2,0.199999999999999,0.2,0.2,0.199999999999999,0.200000000000001,0.199999999999999,0.199999999999999,0.199999999999999,0.199999999999999],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2588430,0,526736,0,0,1390114],"x":[0.6,0.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,791624,0,0,0,0,0,0,0,0],"text":["count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:  791624<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]","count:       0<br />rating: 3.5<br />cut(rating, 100): (3.47,3.51]"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(0,176,246,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,255,1)"}},"name":"(3.47,3.51]","legendgroup":"(3.47,3.51]","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.199999999999999,0.2,0.2,0.2,0.199999999999999,0.2,0.199999999999999,0.2,0.2,0.199999999999999,0.200000000000001,0.199999999999999,0.199999999999999,0.199999999999999,0.199999999999999],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,526736,0,0,1390114],"x":[0.6,0.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2588430,0,0,0,0,0],"text":["count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count: 2588430<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]","count:       0<br />rating: 4.0<br />cut(rating, 100): (3.96,4.01]"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(149,144,255,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,255,1)"}},"name":"(3.96,4.01]","legendgroup":"(3.96,4.01]","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.199999999999999,0.2,0.2,0.2,0.199999999999999,0.2,0.199999999999999,0.2,0.2,0.199999999999999,0.200000000000001,0.199999999999999,0.199999999999999,0.199999999999999,0.199999999999999],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1390114],"x":[0.6,0.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,526736,0,0,0],"text":["count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:  526736<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]","count:       0<br />rating: 4.5<br />cut(rating, 100): (4.46,4.5]"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(231,107,243,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,255,1)"}},"name":"(4.46,4.5]","legendgroup":"(4.46,4.5]","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.199999999999999,0.2,0.2,0.2,0.199999999999999,0.2,0.199999999999999,0.2,0.2,0.199999999999999,0.200000000000001,0.199999999999999,0.199999999999999,0.199999999999999,0.199999999999999],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[0.6,0.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1390114],"text":["count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count:       0<br />rating: 5.0<br />cut(rating, 100): (4.96,5]","count: 1390114<br />rating: 5.0<br />cut(rating, 100): (4.96,5]"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(255,98,188,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,255,1)"}},"name":"(4.96,5]","legendgroup":"(4.96,5]","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3.51246520160155,3.51246520160155],"y":[-129421.5,2717851.5],"text":"xintercept: 3.512465","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(255,0,0,1)","dash":"dash"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.0983810709838,"r":7.97011207970112,"b":40.6475716064757,"l":59.7758405977584},"plot_bgcolor":"rgba(0,43,54,1)","paper_bgcolor":"rgba(0,43,54,1)","font":{"color":"rgba(88,110,117,1)","family":"","size":15.9402241594022},"title":{"text":"Distribution of ratings","font":{"color":"rgba(131,148,150,1)","family":"","size":19.1282689912827},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.27,5.33],"tickmode":"array","ticktext":["0.5","1.0","1.5","2.0","2.5","3.0","3.5","4.0","4.5","5.0"],"tickvals":[0.5,1,1.5,2,2.5,3,3.5,4,4.5,5],"categoryorder":"array","categoryarray":["0.5","1.0","1.5","2.0","2.5","3.0","3.5","4.0","4.5","5.0"],"nticks":null,"ticks":"outside","tickcolor":"rgba(88,110,117,1)","ticklen":3.98505603985056,"tickwidth":0.724555643609193,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":12.7521793275218},"tickangle":-0,"showline":true,"linecolor":"rgba(88,110,117,1)","linewidth":0.724555643609193,"showgrid":true,"gridcolor":"rgba(7,54,66,1)","gridwidth":0.724555643609193,"zeroline":false,"anchor":"y","title":{"text":"Ratings Scale","font":{"color":"rgba(131,148,150,1)","family":"","size":15.9402241594022}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-129421.5,2717851.5],"tickmode":"array","ticktext":["0e+00","1e+06","2e+06"],"tickvals":[0,1000000,2000000],"categoryorder":"array","categoryarray":["0e+00","1e+06","2e+06"],"nticks":null,"ticks":"outside","tickcolor":"rgba(88,110,117,1)","ticklen":3.98505603985056,"tickwidth":0.724555643609193,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":12.7521793275218},"tickangle":-0,"showline":true,"linecolor":"rgba(88,110,117,1)","linewidth":0.724555643609193,"showgrid":true,"gridcolor":"rgba(7,54,66,1)","gridwidth":0.724555643609193,"zeroline":false,"anchor":"x","title":{"text":"Sum Of Rating","font":{"color":"rgba(131,148,150,1)","family":"","size":15.9402241594022}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(0,43,54,1)","bordercolor":"transparent","borderwidth":2.06156048675734,"font":{"color":"rgba(88,110,117,1)","family":"","size":12.7521793275218},"y":0.970472440944882},"annotations":[{"text":"cut(rating, 100)","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(131,148,150,1)","family":"","size":15.9402241594022},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"169c24fc413b":{"x":{},"fill":{},"type":"bar"},"169cf2189e":{"xintercept":{}}},"cur_data":"169c24fc413b","visdat":{"169c24fc413b":["function (y) ","x"],"169cf2189e":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>For the training of our ML algorithms we want to <strong>penalized movies rated by low number of users.So in order to put more weight on movies that have been rated by more people, we will add 2 more features in our data sets. </strong><br />
<br/> <strong>-Number of users per movie and </strong><br />
<strong>-Number of movies per user( how many movies had that user rated ). So movies and users that have not many rates will be penalized during the ML training </strong><br />
<code>Add new dimensions: Number of movies per user. And number of users per movie</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edx &lt;-<span class="st"> </span>edx <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(userId) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">number_movies_byUser =</span> <span class="kw">n</span>())


edx &lt;-<span class="st"> </span>edx <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(movieId) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">number_users_byMovie =</span> <span class="kw">n</span>())


validation &lt;-<span class="st"> </span>validation <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(userId) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">number_movies_byUser =</span> <span class="kw">n</span>())


validation &lt;-<span class="st"> </span>validation <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(movieId) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">number_users_byMovie =</span> <span class="kw">n</span>())</code></pre></div>
<p><code>Interactive plot of the most rated movies (Only those that have been rated over 20.000 times)</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edx <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(number_users_byMovie <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20000</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">reorder</span>(title, number_users_byMovie), number_users_byMovie, <span class="dt">fill =</span> number_users_byMovie)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;PuBuGn&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Movie Title&quot;</span>) <span class="op">+</span><span class="kw">ylab</span>(<span class="st">&#39;Number of Ratings&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Most rated movies&quot;</span>) <span class="op">+</span>
<span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>)) <span class="op">+</span></code></pre></div>
<div class="figure">
<img src="images/mostratedmovies.PNG" />

</div>
<p><br/> <code>Interactive bar graph display: in order to understand the distribution of the sum of ratings per genres,and movies per genres</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> edx_movies_metrics, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(genres, <span class="op">-</span>Ratings_perGenre_Sum), 
    <span class="dt">y =</span> Ratings_perGenre_Sum, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">fill =</span> genres, <span class="dt">label =</span> Ratings_perGenre_Sum)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Movies genres&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Sum of ratings in Mio&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Sum of ratings per genre&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma) <span class="op">+</span><span class="st"> </span><span class="kw">theme_solarized</span>(<span class="dt">light =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>()</code></pre></div>
<div class="figure">
<img src="images/sumofratingspergenre.PNG" />

</div>
<p><br/> In the bar graph is also clear that the <strong>distribution is not equal in all genres. After the fantasy genre, we can see the exponential growth in the number of ratings. </strong><br />
<strong>That is an indication that probably we wil penalize the genres with low number of ratings, in our model </strong> <br/> <code>Word count cloud plot - with the most rated genres</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">wordcloud</span>(<span class="dt">words =</span> edx_movies_metrics<span class="op">$</span>genres, <span class="dt">freq =</span> edx_movies_metrics<span class="op">$</span>Ratings_perGenre_Sum, 
    <span class="dt">min.freq =</span> <span class="dv">10</span>, <span class="dt">max.words =</span> <span class="dv">10</span>, <span class="dt">random.order =</span> <span class="ot">FALSE</span>, <span class="dt">random.color =</span> <span class="ot">FALSE</span>, 
    <span class="dt">rot.per =</span> <span class="fl">0.35</span>, <span class="dt">scale =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="fl">0.2</span>), <span class="dt">font =</span> <span class="dv">4</span>, <span class="dt">colors =</span> <span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Dark2&quot;</span>), 
    <span class="dt">main =</span> <span class="st">&quot;Most rated genres&quot;</span>)</code></pre></div>
<p><img src="HTML__MINE_files/figure-html/unnamed-chunk-22-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p><br/> <code>Bar graph plot to observe - the distribution of ratings mean - per genres</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> edx_movies_metrics, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(genres, <span class="op">-</span>Ratings_perGenre_Mean), 
    <span class="dt">y =</span> Ratings_perGenre_Mean, <span class="dt">colour =</span> Ratings_perGenre_Sum, <span class="dt">fill =</span> genres, 
    <span class="dt">label =</span> Ratings_perGenre_Mean)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Movies genres&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Mean of ratings&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Mean of ratings per genre&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">vjust =</span> <span class="op">-</span><span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, 
    <span class="dt">check_overlap =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">theme_solarized</span>(<span class="dt">light =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_col</span>()</code></pre></div>
<p><img src="HTML__MINE_files/figure-html/unnamed-chunk-23-1.png" width="90%" style="display: block; margin: auto;" /> <br/> In order to improve the results from our algorithms we will a We created a new df with(more dimensions) all the genres extracted and displayed as factors in order to use more features and improve our models if needed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edx_matrix &lt;-<span class="st"> </span>edx

validation_matrix &lt;-<span class="st"> </span>validation

genres &lt;-<span class="st"> </span>edx_matrix<span class="op">$</span>genres <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">|&quot;</span>)

genres_unique &lt;-<span class="st"> </span>genres <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>()


<span class="kw">ncol</span>(edx_matrix)</code></pre></div>
<pre><code>[1] 9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cols &lt;-<span class="st"> </span><span class="kw">ncol</span>(edx_matrix)

<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(genres_unique)) {
    id &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="dt">pattern =</span> genres_unique[i], edx_matrix<span class="op">$</span>genres)
    edx_matrix[[cols <span class="op">+</span><span class="st"> </span>i]] &lt;-<span class="st"> </span><span class="dv">0</span>
    edx_matrix[[cols <span class="op">+</span><span class="st"> </span>i]][id] &lt;-<span class="st"> </span><span class="dv">1</span>
}

<span class="kw">names</span>(edx_matrix)[(cols <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">:</span><span class="kw">ncol</span>(edx_matrix)] &lt;-<span class="st"> </span>genres_unique</code></pre></div>
<p><code>Same for our test set</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ncol</span>(validation_matrix)</code></pre></div>
<pre><code>[1] 9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cols &lt;-<span class="st"> </span><span class="kw">ncol</span>(validation_matrix)

<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(genres_unique)) {
    id &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="dt">pattern =</span> genres_unique[i], validation_matrix<span class="op">$</span>genres)
    validation_matrix[[cols <span class="op">+</span><span class="st"> </span>i]] &lt;-<span class="st"> </span><span class="dv">0</span>
    validation_matrix[[cols <span class="op">+</span><span class="st"> </span>i]][id] &lt;-<span class="st"> </span><span class="dv">1</span>
}

<span class="kw">names</span>(validation_matrix)[(cols <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">:</span><span class="kw">ncol</span>(validation_matrix)] &lt;-<span class="st"> </span>genres_unique</code></pre></div>
<p><br/> Also instead of having the year released we will create a new feature representing:<br />
<code>how old is every movie and drop the year released dimension.</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edx_matrix &lt;-<span class="st"> </span>edx_matrix <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">age_of_movie =</span> <span class="dv">2019</span> <span class="op">-</span><span class="st"> </span>release_year)

validation_matrix &lt;-<span class="st"> </span>validation_matrix <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">age_of_movie =</span> <span class="dv">2019</span> <span class="op">-</span><span class="st"> </span>release_year)</code></pre></div>
<p><br/> <code>Observe the new df with the genres as dimensions</code></p>
<pre><code># A tibble: 6 x 30
# Groups:   movieId [6]
  userId movieId rating year_rated title genres release_year
   &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;
1      1     122      5 1996       Boom~ Comed~         1992
2      1     185      5 1996       Net,~ Actio~         1995
3      1     292      5 1996       Outb~ Actio~         1995
4      1     316      5 1996       Star~ Actio~         1994
5      1     329      5 1996       Star~ Actio~         1994
6      1     355      5 1996       Flin~ Child~         1994
# ... with 23 more variables: number_movies_byUser &lt;int&gt;,
#   number_users_byMovie &lt;int&gt;, Comedy &lt;dbl&gt;, Romance &lt;dbl&gt;, Action &lt;dbl&gt;,
#   Crime &lt;dbl&gt;, Thriller &lt;dbl&gt;, Drama &lt;dbl&gt;, `Sci-Fi` &lt;dbl&gt;,
#   Adventure &lt;dbl&gt;, Children &lt;dbl&gt;, Fantasy &lt;dbl&gt;, War &lt;dbl&gt;,
#   Animation &lt;dbl&gt;, Musical &lt;dbl&gt;, Western &lt;dbl&gt;, Mystery &lt;dbl&gt;,
#   `Film-Noir` &lt;dbl&gt;, Horror &lt;dbl&gt;, Documentary &lt;dbl&gt;, IMAX &lt;dbl&gt;, `(no
#   genres listed)` &lt;dbl&gt;, age_of_movie &lt;dbl&gt;</code></pre>
<p>We noticed a column with no genres that contains only one movie in edx matrix, we will delete that column (outlier), also we will delete the columns (genres) with low sum of ratings. The reasons for this is because the train set is already big 9000047 rows so we dont want to have many dimensions during the models building. The second reason is to prevent overfidding<br />
<code>Deletion of the dimensions that are outliers</code></p>
<p>In our data sets the variation of the age of the movies starts from 11 years (that means 2008- this is the last year we have movies until 104 then are the oldest movies we have).<br />
We will check if there is a correlation between age of movie and ratings.</p>
<p><code>First we will create a new object,in order to observe easier, and also plot faster and with less memory!</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_rating_per_oldness &lt;-<span class="st"> </span>edx_matrix <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(age_of_movie) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">avg_rating_by_age =</span> <span class="kw">mean</span>(rating))</code></pre></div>
<p><code>We will examine if there is a correlation between age of movie and rating.</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggpairs</span>(avg_rating_per_oldness, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;age_of_movie&quot;</span>), <span class="dt">title =</span> <span class="st">&quot;Age of Movie VS Rating correlation&quot;</span>, 
    <span class="dt">upper =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> <span class="kw">wrap</span>(<span class="st">&quot;cor&quot;</span>, <span class="dt">size =</span> <span class="dv">10</span>)), <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> <span class="st">&quot;smooth&quot;</span>))</code></pre></div>
<p><img src="HTML__MINE_files/figure-html/ggpairs%20age%20movie%20-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>We can observe on the graph the negative skewness</p>
<p>We can clearly notice that there is a positive trend. The oldest the movie the highest the ratings it receives.</p>
<p>This is due to 2 reasons.</p>
<p><strong>-First the oldest the movie the more ratings it has.</strong><br />
<strong>-Second usually the old movies are consider classics and they are rated better by the audience</strong><br />
<br/> <code>It looks that the **age of movie will have low p value in or ML models training.**</code>We create one more interactive plot to demonstrate it`</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plotage &lt;-<span class="st"> </span>avg_rating_per_oldness <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age_of_movie, <span class="dt">y =</span> avg_rating_by_age)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Age of Movies vs Rating&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_solarized</span>(<span class="dt">light =</span> <span class="ot">FALSE</span>)
<span class="kw">ggplotly</span>(plotage)</code></pre></div>
<p><img src="images/agevsrating.PNG" /> <code>Check if there is a correlation between the year that the film was rated and the rating. The films rated year varies from 1995 until 2009.</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_rating_per_yearRated &lt;-<span class="st"> </span>edx_matrix <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(year_rated) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">avg_rating =</span> <span class="kw">mean</span>(rating))
avg_rating_per_yearRated</code></pre></div>
<pre><code># A tibble: 15 x 2
   year_rated avg_rating
   &lt;chr&gt;           &lt;dbl&gt;
 1 1995             4   
 2 1996             3.55
 3 1997             3.59
 4 1998             3.51
 5 1999             3.62
 6 2000             3.58
 7 2001             3.54
 8 2002             3.47
 9 2003             3.47
10 2004             3.43
11 2005             3.44
12 2006             3.47
13 2007             3.47
14 2008             3.54
15 2009             3.46</code></pre>
<p>We observe that the oldest the movie was rated (1995) the highest was the rating. Same correlation as the age of the movie.</p>
<p>Now we have really godd insight of our datasets.<br />
We enrich them by adding new dimensions. And also we identified the outliers and the correlations.</p>
<p>Now we will proceed with the models training. <br/></p>
<p><strong>Model Building - Training and Validation</strong></p>
</div>
<div id="matrix-factorization-with-parallel-stochastic-gradient-descent" class="section level1">
<h1>Matrix Factorization with parallel stochastic gradient descent</h1>
<p><br> <br></p>
<p>As we mentioned earliaer. There are 2 types of recommender systems:<br />
Content filtering (based on the description of the item - also called meta data or side information) <br/> And collaborative Filtering: Those techniques are calculating the similarity<br />
measures of the target ITEMS and finding the minimum (Euclidean distance,<br />
or Cosine distance, or other metric, it depends on the algorithm). This is done<br />
by filtering the interests of a user, by collecting preferences from many users<br />
(collaborating). The underlying assumption is that if a person X has the same<br />
opinion as a person Y then the recommendation system should be based<br />
on preferences of person Y (similarity).<br />
<br/> We will enhance the collaborative filtering with the help of Matrix factorization.<br />
MF is a class of collaborative filtering algorithms used in recommender systems.<br />
<br/> Matrix factorization algorithms work by decomposing the user-item interaction matrix<br />
into the product of two lower dimensionality rectangular matrices.This family of methods<br />
became widely known during the Netflix prize challenge due to its effectiveness as<br />
reported by Simon Funk in his 2006 blog post, where he shared his findings with the research community<br />
[recommender](<a href="https://en.wikipedia.org/wiki/Matrix_factorization_(recommender_systems)" class="uri">https://en.wikipedia.org/wiki/Matrix_factorization_(recommender_systems)</a> <br/> We will apply Matrix Factorization with parallel stochastic gradient descent. With the help of “recosystem” package it is an R wrapper of the LIBMF library which creates a Recommender System by Using Parallel Matrix Factorization. The main task of recommender system is to predict unknown entries in the rating matrix based on observed values. <br/> More info on the recosystem package and the techniques <a href="https://cran.r-project.org/web/packages/recosystem/vignettes/introduction.html">recosystem</a></p>
<p><code>Before we proceed with the model building,training and validation we define the RMSE function</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RMSE &lt;-<span class="st"> </span><span class="cf">function</span>(true_ratings, predicted_ratings) {
    <span class="kw">sqrt</span>(<span class="kw">mean</span>((true_ratings <span class="op">-</span><span class="st"> </span>predicted_ratings)<span class="op">^</span><span class="dv">2</span>))
}</code></pre></div>
<p>The data file for training set needs to be arranged in sparse matrix triplet form, i.e., each line in the file contains three numbers in order to use recosystem package we create 2 new matrices (our train and our validation set) with the below 3 features<br />
<strong>-(movieId,userId,rating)</strong><br />
<code>Create data sets for algorithm Matrix Factorization</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edx_factorization &lt;-<span class="st"> </span>edx <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(movieId, userId, rating)
validation_factorization &lt;-<span class="st"> </span>validation <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(movieId, userId, rating)

edx_factorization &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(edx_factorization)
validation_factorization &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(validation_factorization)</code></pre></div>
<p><br/> <code>Recosystem needs to save the files as tables on hard disk, (recosystem package needed)</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.table</span>(edx_factorization, <span class="dt">file =</span> <span class="st">&quot;trainingset.txt&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>, 
    <span class="dt">col.names =</span> <span class="ot">FALSE</span>)



<span class="kw">write.table</span>(validation_factorization, <span class="dt">file =</span> <span class="st">&quot;validationset.txt&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>, 
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">col.names =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><code>data_file is specific recosystem command</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
training_dataset &lt;-<span class="st"> </span><span class="kw">data_file</span>(<span class="st">&quot;trainingset.txt&quot;</span>)

validation_dataset &lt;-<span class="st"> </span><span class="kw">data_file</span>(<span class="st">&quot;validationset.txt&quot;</span>)</code></pre></div>
<p><code>We reate a model object (a Reference Class object in R) by calling the function Reco()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r =<span class="st"> </span><span class="kw">Reco</span>()</code></pre></div>
<p><strong>This step is optional.</strong> <code>We call the $tune() method to select the best tuning parameters</code><br />
(along a set of candidate values) You need to perform many different settings until you<br />
will reach the optimal.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">opts =<span class="st"> </span>r<span class="op">$</span><span class="kw">tune</span>(training_dataset, <span class="dt">opts =</span> <span class="kw">list</span>(<span class="dt">dim =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>), <span class="dt">lrate =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, 
    <span class="fl">0.2</span>), <span class="dt">costp_l1 =</span> <span class="dv">0</span>, <span class="dt">costq_l1 =</span> <span class="dv">0</span>, <span class="dt">nthread =</span> <span class="dv">1</span>, <span class="dt">niter =</span> <span class="dv">10</span>))</code></pre></div>

<p><code>Display of the tuning</code></p>
<pre><code>$min
$min$dim
[1] 30

$min$costp_l1
[1] 0

$min$costp_l2
[1] 0.1

$min$costq_l1
[1] 0

$min$costq_l2
[1] 0.01

$min$lrate
[1] 0.1

$min$loss_fun
[1] 0.7974779


$res
   dim costp_l1 costp_l2 costq_l1 costq_l2 lrate  loss_fun
1   10        0     0.01        0     0.01   0.1 0.8246018
2   20        0     0.01        0     0.01   0.1 0.8083978
3   30        0     0.01        0     0.01   0.1 0.8148374
4   10        0     0.10        0     0.01   0.1 0.8280235
5   20        0     0.10        0     0.01   0.1 0.8040914
6   30        0     0.10        0     0.01   0.1 0.7974779
7   10        0     0.01        0     0.10   0.1 0.8269870
8   20        0     0.01        0     0.10   0.1 0.8023862
9   30        0     0.01        0     0.10   0.1 0.8005307
10  10        0     0.10        0     0.10   0.1 0.8387589
 [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 14 rows ]</code></pre>
<p><code>Now we train the model by calling the $train() method. A number of parameters can be set inside the function, coming from the result of the previous step - $tune().</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r<span class="op">$</span><span class="kw">train</span>(training_dataset, <span class="dt">opts =</span> <span class="kw">c</span>(opts<span class="op">$</span>min, <span class="dt">nthread =</span> <span class="dv">1</span>, <span class="dt">niter =</span> <span class="dv">20</span>))

<span class="st">&quot;We write predictions to a tempfile on HDisk&quot;</span>

stored_prediction =<span class="st"> </span><span class="kw">tempfile</span>()</code></pre></div>
<p><code>With the $predict() method we will make  predictions on validation set and will calculate RMSE:</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r<span class="op">$</span><span class="kw">predict</span>(validation_dataset, <span class="kw">out_file</span>(stored_prediction))



real_ratings &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;validationset.txt&quot;</span>, <span class="dt">header =</span> <span class="ot">FALSE</span>, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)<span class="op">$</span>V3


pred_ratings &lt;-<span class="st"> </span><span class="kw">scan</span>(stored_prediction)</code></pre></div>
<p><strong>Mean squared error (abbreviated MSE)</strong> and <strong>root mean square error (RMSE)</strong> refer to the amount by which the values predicted by an estimator differ from the quantities being estimated (typically outside the sample from which the model was estimated).</p>
<p>We calculate the <strong>standard deviation of the residuals (prediction errors) RMSE</strong> . Between the predicted ratings and the real ratings . If one or more predictors are significant, the second step is to assess how well the model fits the data by inspecting the <strong>Residuals Standard Error (RSE).</strong><br />
<br/></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rmse_of_model_mf &lt;-<span class="st"> </span><span class="kw">RMSE</span>(real_ratings, pred_ratings)</code></pre></div>
<p>Root mean squared error of the Matrix Factorization model</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rmse_of_model_mf</code></pre></div>
<pre><code>[1] 0.7829978</code></pre>
<p>We observe that the RMSE is extremely low. And possibly until know the Matrix factorization with SGD is the best approach to create a recommender system. I would like to thank Yu-Chin Juan, Wei-Sheng Chin, Yong Zhuang</p>
<p>for creating the LIMBF library but also Yixuan Qiu that created the R wrapper.<br />
<a href="https://cran.r-project.org/web/packages/recosystem/vignettes/introduction.html">link</a></p>
<p><code>We will compare the first 50 predictions of the MF model with the real ratings. First we round the predictions for visualization convenience</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred_ratings_rounded &lt;-<span class="st"> </span>pred_ratings



pred_ratings_rounded &lt;-<span class="st"> </span><span class="kw">round</span>(pred_ratings_rounded<span class="op">/</span><span class="fl">0.5</span>) <span class="op">*</span><span class="st"> </span><span class="fl">0.5</span>



MF_first50_pred &lt;-<span class="st"> </span><span class="kw">data.frame</span>(real_ratings[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>], pred_ratings_rounded[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>])


<span class="kw">names</span>(MF_first50_pred) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;real_ratings&quot;</span>, <span class="st">&quot;predicted_ratings&quot;</span>)</code></pre></div>
<p><br/> <code>Interactive plot - with the 50 first predicted ratings of the MF model.The light blue are the correct predictions</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pmf &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> MF_first50_pred, <span class="kw">aes</span>(<span class="dt">x =</span> real_ratings, <span class="dt">y =</span> predicted_ratings, 
    <span class="dt">colour =</span> correct_predicted)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Real Ratings&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Predicted Ratings&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Real vs Predicted Ratings&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>, 
    <span class="dt">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()
<span class="kw">ggplotly</span>(pmf)</code></pre></div>
<div id="htmlwidget-617cb9ed291e1ab0c71a" style="width:100%;height:576px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-617cb9ed291e1ab0c71a">{"x":{"data":[{"x":[5.1218949990347,5.01683307709172,4.86435251608491,2.88752895286307,1.81069761887193,3.16022489629686,3.38444650191814,4.48321524225175,4.92289424557239,3.15009559551254,3.06150913499296,2.84733529826626,2.89443001840264,3.06070785522461,2.94688219260424,3.10821084771305,2.84544185204431,3.07406654767692,4.05211696438491,5.09197932314128,3.14855838539079,4.01518179131672,3.93099334854633,3.81891647195444,5.17090129740536,4.15858493391424,1.95962510602549,5.00783966565505,5.03377477619797,4.94305193414912,4.09335569888353,2.88097785478458,4.16218548864126,3.84290333213285,5.1585740157403,5.1726980580017,4.85389242554083,4.13278118120506,4.0822671812959,3.96840348793194,3.82632517321035,4.81788152167574,3.5184588978067,4.8680326837115,4.19392859367654,4.68185517080128,2.67247237563133,4.49239802686498,3.54096558867022,3.85950377006084],"y":[4.10449021374807,5.19345209067687,5.06113785179332,3.52015862427652,4.58252497194335,2.62285165162757,3.99194170786068,4.5695771378465,4.63474085750058,3.58279909482226,3.67611567592248,3.48065175591037,3.55788521496579,3.96703784670681,3.68171808999032,4.46684282189235,4.15185979623348,2.91628307681531,3.97960207425058,3.89301528595388,3.51627726517618,4.8744291245006,4.60453840242699,4.46890382515267,5.07143865227699,3.57402702253312,2.00660770675167,4.43607459729537,4.57658049231395,4.31237455653027,3.84419216364622,2.95859064301476,4.43815539609641,3.41515729697421,4.59923896985129,3.9960524700582,3.95571196293458,3.00481434110552,4.10254972297698,4.34059773879126,3.85054131811485,4.06912503158674,3.19270622590557,3.4733629276976,3.34955245777965,3.88256301917136,2.80912784505635,3.36435714606196,3.92433555210009,3.61270569013432],"text":["real_ratings: 5.0<br />predicted_ratings: 4.0<br />correct_predicted: 0","real_ratings: 5.0<br />predicted_ratings: 5.0<br />correct_predicted: 1","real_ratings: 5.0<br />predicted_ratings: 5.0<br />correct_predicted: 1","real_ratings: 3.0<br />predicted_ratings: 3.5<br />correct_predicted: 0","real_ratings: 2.0<br />predicted_ratings: 4.5<br />correct_predicted: 0","real_ratings: 3.0<br />predicted_ratings: 2.5<br />correct_predicted: 0","real_ratings: 3.5<br />predicted_ratings: 4.0<br />correct_predicted: 0","real_ratings: 4.5<br />predicted_ratings: 4.5<br />correct_predicted: 1","real_ratings: 5.0<br />predicted_ratings: 4.5<br />correct_predicted: 0","real_ratings: 3.0<br />predicted_ratings: 3.5<br />correct_predicted: 0","real_ratings: 3.0<br />predicted_ratings: 3.5<br />correct_predicted: 0","real_ratings: 3.0<br />predicted_ratings: 3.5<br />correct_predicted: 0","real_ratings: 3.0<br />predicted_ratings: 3.5<br />correct_predicted: 0","real_ratings: 3.0<br />predicted_ratings: 4.0<br />correct_predicted: 0","real_ratings: 3.0<br />predicted_ratings: 3.5<br />correct_predicted: 0","real_ratings: 3.0<br />predicted_ratings: 4.5<br />correct_predicted: 0","real_ratings: 3.0<br />predicted_ratings: 4.0<br />correct_predicted: 0","real_ratings: 3.0<br />predicted_ratings: 3.0<br />correct_predicted: 1","real_ratings: 4.0<br />predicted_ratings: 4.0<br />correct_predicted: 1","real_ratings: 5.0<br />predicted_ratings: 4.0<br />correct_predicted: 0","real_ratings: 3.0<br />predicted_ratings: 3.5<br />correct_predicted: 0","real_ratings: 4.0<br />predicted_ratings: 5.0<br />correct_predicted: 0","real_ratings: 4.0<br />predicted_ratings: 4.5<br />correct_predicted: 0","real_ratings: 4.0<br />predicted_ratings: 4.5<br />correct_predicted: 0","real_ratings: 5.0<br />predicted_ratings: 5.0<br />correct_predicted: 1","real_ratings: 4.0<br />predicted_ratings: 3.5<br />correct_predicted: 0","real_ratings: 2.0<br />predicted_ratings: 2.0<br />correct_predicted: 1","real_ratings: 5.0<br />predicted_ratings: 4.5<br />correct_predicted: 0","real_ratings: 5.0<br />predicted_ratings: 4.5<br />correct_predicted: 0","real_ratings: 5.0<br />predicted_ratings: 4.5<br />correct_predicted: 0","real_ratings: 4.0<br />predicted_ratings: 4.0<br />correct_predicted: 1","real_ratings: 3.0<br />predicted_ratings: 3.0<br />correct_predicted: 1","real_ratings: 4.0<br />predicted_ratings: 4.5<br />correct_predicted: 0","real_ratings: 4.0<br />predicted_ratings: 3.5<br />correct_predicted: 0","real_ratings: 5.0<br />predicted_ratings: 4.5<br />correct_predicted: 0","real_ratings: 5.0<br />predicted_ratings: 4.0<br />correct_predicted: 0","real_ratings: 5.0<br />predicted_ratings: 4.0<br />correct_predicted: 0","real_ratings: 4.0<br />predicted_ratings: 3.0<br />correct_predicted: 0","real_ratings: 4.0<br />predicted_ratings: 4.0<br />correct_predicted: 1","real_ratings: 4.0<br />predicted_ratings: 4.5<br />correct_predicted: 0","real_ratings: 4.0<br />predicted_ratings: 4.0<br />correct_predicted: 1","real_ratings: 5.0<br />predicted_ratings: 4.0<br />correct_predicted: 0","real_ratings: 3.5<br />predicted_ratings: 3.0<br />correct_predicted: 0","real_ratings: 5.0<br />predicted_ratings: 3.5<br />correct_predicted: 0","real_ratings: 4.0<br />predicted_ratings: 3.5<br />correct_predicted: 0","real_ratings: 4.5<br />predicted_ratings: 4.0<br />correct_predicted: 0","real_ratings: 2.5<br />predicted_ratings: 3.0<br />correct_predicted: 0","real_ratings: 4.5<br />predicted_ratings: 3.5<br />correct_predicted: 0","real_ratings: 3.5<br />predicted_ratings: 4.0<br />correct_predicted: 0","real_ratings: 4.0<br />predicted_ratings: 3.5<br />correct_predicted: 0"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":["rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)"],"opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":["rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(86,177,247,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)","rgba(19,43,67,1)"]}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2],"y":[2],"name":"99_bec7e36f7d7d10b1bcbe0b4bcda383fc","type":"scatter","mode":"markers","opacity":0,"hoverinfo":"skip","showlegend":false,"marker":{"color":[0,1],"colorscale":[[0,"#132B43"],[0.0526315789473684,"#16314B"],[0.105263157894737,"#193754"],[0.157894736842105,"#1D3E5C"],[0.210526315789474,"#204465"],[0.263157894736842,"#234B6E"],[0.315789473684211,"#275277"],[0.368421052631579,"#2A5980"],[0.421052631578947,"#2E608A"],[0.473684210526316,"#316793"],[0.526315789473684,"#356E9D"],[0.578947368421053,"#3875A6"],[0.631578947368421,"#3C7CB0"],[0.684210526315789,"#3F83BA"],[0.736842105263158,"#438BC4"],[0.789473684210526,"#4792CE"],[0.842105263157895,"#4B9AD8"],[0.894736842105263,"#4EA2E2"],[0.947368421052632,"#52A9ED"],[1,"#56B1F7"]],"colorbar":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"thickness":23.04,"title":"correct_predicted","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"tickmode":"array","ticktext":["0.00","0.25","0.50","0.75","1.00"],"tickvals":[0,0.25,0.5,0.75,1],"tickfont":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"ticklen":2,"len":0.5}},"xaxis":"x","yaxis":"y","frame":null}],"layout":{"margin":{"t":39.2461602324616,"r":7.30593607305936,"b":37.2602739726027,"l":31.4155251141553},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Real vs Predicted Ratings","font":{"color":"rgba(0,0,139,1)","family":"","size":15.9402241594022},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1.64259759691544,5.34079807995819],"tickmode":"array","ticktext":["2","3","4","5"],"tickvals":[2,3,4,5],"categoryorder":"array","categoryarray":["2","3","4","5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"Real Ratings","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1.84726548755541,5.35279430987313],"tickmode":"array","ticktext":["2","3","4","5"],"tickvals":[2,3,4,5],"categoryorder":"array","categoryarray":["2","3","4","5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"Predicted Ratings","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"166014411a2":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"166014411a2","visdat":{"166014411a2":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(MF_first50_pred) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="st">&quot;striped&quot;</span>, <span class="dt">full_width =</span> F, 
    <span class="dt">position =</span> <span class="st">&quot;center&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">column_spec</span>(<span class="dv">1</span>, <span class="dt">border_left =</span> T) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">column_spec</span>(<span class="dv">2</span>, 
    <span class="dt">bold =</span> T, <span class="dt">border_right =</span> T) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">footnote</span>(<span class="dt">general =</span> <span class="st">&quot;MF model 50 first predictions&quot;</span>, 
    <span class="dt">footnote_as_chunk =</span> T)</code></pre></div>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
real_ratings
</th>
<th style="text-align:right;">
predicted_ratings
</th>
<th style="text-align:right;">
correct_predicted
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
5.0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
5.0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
2.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
2.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.5
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.5
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.5
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
5.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
5.0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
2.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
2.0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.5
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
5.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.5
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
2.5
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.5
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
3.5
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
4.0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;">
4.0
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
3.5
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border: 0;" colspan="100%">
<span style="font-style: italic;">Note: </span> <sup></sup> MF model 50 first predictions
</td>
</tr>
</tfoot>
</table>
<p><br/></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">all_models_rmse_results &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Algorithm =</span> <span class="kw">c</span>(<span class="st">&quot;Matrix factorization with SGD&quot;</span>), 
    <span class="dt">RMSE =</span> <span class="kw">c</span>(rmse_of_model_mf))</code></pre></div>
<p><strong>Root Mean Squared error of the Matrix factorization with parallel stochastic gradient descent</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(all_models_rmse_results) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="st">&quot;striped&quot;</span>, 
    <span class="dt">full_width =</span> F, <span class="dt">position =</span> <span class="st">&quot;center&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">column_spec</span>(<span class="dv">1</span>, <span class="dt">border_left =</span> T) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">column_spec</span>(<span class="dv">2</span>, <span class="dt">bold =</span> T, <span class="dt">border_right =</span> T)</code></pre></div>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Algorithm
</th>
<th style="text-align:right;">
RMSE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;border-left:1px solid;">
Matrix factorization with SGD
</td>
<td style="text-align:right;font-weight: bold;border-right:1px solid;">
0.7829978
</td>
</tr>
</tbody>
</table>
</div>
<div id="h2o-machine-learning-training-build-and-validating-part" class="section level1">
<h1>H2o Machine learning training, build and validating part</h1>
<p><br> <br> H2o open source machine learning and artificial intelligence platform</p>
<p><code>Create factors because in h2o the dependent variables need to be factors</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edx_h2o &lt;-<span class="st"> </span>edx_matrix

edx_h2o<span class="op">$</span>userId &lt;-<span class="st"> </span><span class="kw">as.factor</span>(edx_h2o<span class="op">$</span>userId)
edx_h2o<span class="op">$</span>movieId &lt;-<span class="st"> </span><span class="kw">as.factor</span>(edx_h2o<span class="op">$</span>movieId)
edx_h2o<span class="op">$</span>Drama &lt;-<span class="st"> </span><span class="kw">as.factor</span>(edx_h2o<span class="op">$</span>Drama)
edx_h2o<span class="op">$</span>Comedy &lt;-<span class="st"> </span><span class="kw">as.factor</span>(edx_h2o<span class="op">$</span>Comedy)
edx_h2o<span class="op">$</span>age_of_movie &lt;-<span class="st"> </span><span class="kw">as.factor</span>(edx_h2o<span class="op">$</span>age_of_movie)
edx_h2o<span class="op">$</span>Thriller &lt;-<span class="st"> </span><span class="kw">as.factor</span>(edx_h2o<span class="op">$</span>Thriller)
edx_h2o<span class="op">$</span>Action &lt;-<span class="st"> </span><span class="kw">as.factor</span>(edx_h2o<span class="op">$</span>Action)
edx_h2o<span class="op">$</span>Adventure &lt;-<span class="st"> </span><span class="kw">as.factor</span>(edx_h2o<span class="op">$</span>Adventure)
edx_h2o<span class="op">$</span>Crime &lt;-<span class="st"> </span><span class="kw">as.factor</span>(edx_h2o<span class="op">$</span>Crime)
edx_h2o<span class="op">$</span><span class="st">`</span><span class="dt">Sci-Fi</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="kw">as.factor</span>(edx_h2o<span class="op">$</span><span class="st">`</span><span class="dt">Sci-Fi</span><span class="st">`</span>)
edx_h2o<span class="op">$</span>year_rated &lt;-<span class="st"> </span><span class="kw">as.factor</span>(edx_h2o<span class="op">$</span>year_rated)

validation_h2o &lt;-<span class="st"> </span>validation_matrix

validation_h2o<span class="op">$</span>userId &lt;-<span class="st"> </span><span class="kw">as.factor</span>(validation_h2o<span class="op">$</span>userId)
validation_h2o<span class="op">$</span>movieId &lt;-<span class="st"> </span><span class="kw">as.factor</span>(validation_h2o<span class="op">$</span>movieId)
validation_h2o<span class="op">$</span>Drama &lt;-<span class="st"> </span><span class="kw">as.factor</span>(validation_h2o<span class="op">$</span>Drama)
validation_h2o<span class="op">$</span>Comedy &lt;-<span class="st"> </span><span class="kw">as.factor</span>(validation_h2o<span class="op">$</span>Comedy)
validation_h2o<span class="op">$</span>age_of_movie &lt;-<span class="st"> </span><span class="kw">as.factor</span>(validation_h2o<span class="op">$</span>age_of_movie)
validation_h2o<span class="op">$</span>Thriller &lt;-<span class="st"> </span><span class="kw">as.factor</span>(validation_h2o<span class="op">$</span>Thriller)
validation_h2o<span class="op">$</span>Action &lt;-<span class="st"> </span><span class="kw">as.factor</span>(validation_h2o<span class="op">$</span>Action)
validation_h2o<span class="op">$</span>Adventure &lt;-<span class="st"> </span><span class="kw">as.factor</span>(validation_h2o<span class="op">$</span>Adventure)
validation_h2o<span class="op">$</span>Crime &lt;-<span class="st"> </span><span class="kw">as.factor</span>(validation_h2o<span class="op">$</span>Crime)
validation_h2o<span class="op">$</span><span class="st">`</span><span class="dt">Sci-Fi</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="kw">as.factor</span>(validation_h2o<span class="op">$</span><span class="st">`</span><span class="dt">Sci-Fi</span><span class="st">`</span>)
validation_h2o<span class="op">$</span>year_rated &lt;-<span class="st"> </span><span class="kw">as.factor</span>(validation_h2o<span class="op">$</span>year_rated)</code></pre></div>
<p><br/></p>
<p><code>Start of the H2o cluster into your environment. Adjust RAM accordingly</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(h2o)
<span class="kw">h2o.init</span>(<span class="dt">ignore_config =</span> <span class="ot">TRUE</span>, <span class="dt">nthreads =</span> <span class="op">-</span><span class="dv">1</span>, <span class="dt">max_mem_size =</span> <span class="st">&quot;24G&quot;</span>)</code></pre></div>
<pre><code>
H2O is not running yet, starting it now...

Note:  In case of errors look at the following log files:
    C:\Users\npapaco\AppData\Local\Temp\2\RtmpsfedAc/h2o_npapaco_started_from_r.out
    C:\Users\npapaco\AppData\Local\Temp\2\RtmpsfedAc/h2o_npapaco_started_from_r.err


Starting H2O JVM and connecting:  Connection successful!

R is connected to the H2O cluster: 
    H2O cluster uptime:         2 seconds 250 milliseconds 
    H2O cluster timezone:       Europe/Berlin 
    H2O data parsing timezone:  UTC 
    H2O cluster version:        3.22.1.1 
    H2O cluster version age:    4 months and 6 days !!! 
    H2O cluster name:           H2O_started_from_R_npapaco_jms911 
    H2O cluster total nodes:    1 
    H2O cluster total memory:   21.33 GB 
    H2O cluster total cores:    8 
    H2O cluster allowed cores:  8 
    H2O cluster healthy:        TRUE 
    H2O Connection ip:          localhost 
    H2O Connection port:        54321 
    H2O Connection proxy:       NA 
    H2O Internal Security:      FALSE 
    H2O API Extensions:         Algos, AutoML, Core V3, Core V4 
    R Version:                  R version 3.5.3 (2019-03-11) </code></pre>
<p><strong>After the start of the cluster optionally we can access it from browser to <a href="http://localhost:54321" class="uri">http://localhost:54321</a> </strong> I recommend to try it. Play also with pojo saving of models <br/> <code>H2o algorithms are working only with H2o frameworks. We create also a split on the train data.</code> but for the model evaluation we will use the initial test set (validation)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">splits3 &lt;-<span class="st"> </span><span class="kw">h2o.splitFrame</span>(<span class="kw">as.h2o</span>(edx_h2o), <span class="dt">ratios =</span> <span class="fl">0.7</span>, <span class="dt">seed =</span> <span class="dv">1</span>)

train3 &lt;-<span class="st"> </span>splits3[[<span class="dv">1</span>]]
test3 &lt;-<span class="st"> </span>splits3[[<span class="dv">2</span>]]

test_validation &lt;-<span class="st"> </span><span class="kw">as.h2o</span>(validation_h2o)</code></pre></div>
<p><br/></p>
<p>We start with h2o automl - H2O’s AutoML can be used for automating the machine learning workflow, which includes automatic training and tuning of many models within a user-specified time-limit. Stacked Ensembles - one based on all previously trained models, another one on the best model of each family - will be automatically trained on collections of individual models to produce highly predictive ensemble models which, in most cases, will be the top performing models in the AutoML Leaderboard.</p>
<p>(<a href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html" class="uri">http://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html</a>)</p>
</div>
<div id="h2o-automl" class="section level1">
<h1>H2O AutoML</h1>
<p><br> <br> H2O’s AutoML can be used for <strong>automating the machine learning workflow </strong>, which includes <strong>automatic training and tuning </strong> of many models within a user-specified time-limit. Stacked Ensembles - one based on all previously trained models, another one on the best model of each family - will be automatically trained on collections of individual models to produce highly predictive ensemble models which, in most cases, will be the <strong>top performing models in the AutoML Leaderboard. </strong></p>
<p>(<a href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html" class="uri">http://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html</a>)<br />
<br/> <code>H2o Auto ML hyperparameters</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">h2oamlmodel2 &lt;-<span class="st"> </span><span class="kw">h2o.automl</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;movieId&quot;</span>, <span class="st">&quot;n.users_bymovie&quot;</span>, <span class="st">&quot;age_of_movie&quot;</span>, 
    <span class="st">&quot;Drama&quot;</span>, <span class="st">&quot;Comedy&quot;</span>), <span class="dt">y =</span> <span class="st">&quot;rating&quot;</span>, <span class="dt">training_frame =</span> train3, <span class="dt">leaderboard_frame =</span> test_validation, 
    <span class="dt">project_name =</span> <span class="st">&quot;movielens&quot;</span>, <span class="dt">max_models =</span> <span class="dv">20</span>, <span class="dt">max_runtime_secs =</span> <span class="dv">3600</span>, <span class="dt">nfolds =</span> <span class="dv">3</span>, 
    <span class="dt">keep_cross_validation_predictions =</span> <span class="ot">TRUE</span>, <span class="dt">seed =</span> <span class="dv">1</span>)</code></pre></div>
<p><code>The model with the least RMSE in the leaderboard</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">h2oamlmodel2<span class="op">@</span>leader</code></pre></div>
<pre><code>Model Details:
==============

H2ORegressionModel: drf
Model ID:  DRF_1_AutoML_20190424_155200 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth
1              50                       50              185395         1
  max_depth mean_depth min_leaves max_leaves mean_leaves
1        20   14.40000          2        680   160.96000


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  1.01896
RMSE:  1.009436
MAE:  0.8091325
RMSLE:  0.2679033
Mean Residual Deviance :  1.01896



H2ORegressionMetrics: drf
** Reported on cross-validation data. **
** 3-fold cross-validation on training data (Metrics computed for combined holdout predictions) **

MSE:  1.017104
RMSE:  1.008516
MAE:  0.8084183
RMSLE:  0.2677314
Mean Residual Deviance :  1.017104


Cross-Validation Metrics Summary: 
                              mean            sd cv_1_valid cv_2_valid
mae                      0.8084183   2.020126E-5  0.8083981 0.80839807
mean_residual_deviance   1.0171036 1.16297306E-4   1.016921  1.0173197
mse                      1.0171036 1.16297306E-4   1.016921  1.0173197
r2                     0.095347136   8.510263E-5 0.09520545  0.0953363
residual_deviance        1.0171036 1.16297306E-4   1.016921  1.0173197
rmse                     1.0085155  5.7656973E-5   1.008425  1.0086226
rmsle                    0.2677314   3.339011E-5 0.26766708  0.2677791
                       cv_3_valid
mae                     0.8084587
mean_residual_deviance  1.0170699
mse                     1.0170699
r2                     0.09549966
residual_deviance       1.0170699
rmse                    1.0084988
rmsle                  0.26774806</code></pre>
<p>we see the model that had the lowest RMSE on the leaderboard .The (leader) of all models tested was the below.</p>
<p>-Model ID: DRF_1_AutoML_20190424_155200.</p>
<p>-Algorithm: Algorithm: Distributed Random Forest<br />
<br/> <code>Display of the 6 best models from the leaderboard</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">h2oamlmodel2<span class="op">@</span>leaderboard</code></pre></div>
<pre><code>                                   model_id mean_residual_deviance
1              DRF_1_AutoML_20190424_155200               1.077967
2              XRT_1_AutoML_20190424_155200               1.088622
3 GLM_grid_1_AutoML_20190424_155200_model_1               1.099932
4              GBM_4_AutoML_20190424_155200               1.112490
5              GBM_2_AutoML_20190424_155200               1.116864
6 GLM_grid_1_AutoML_20190424_142708_model_1               1.117170
      rmse      mse       mae     rmsle
1 1.038252 1.077967 0.8410296 0.2702502
2 1.043370 1.088622 0.8475965 0.2717722
3 1.048777 1.099932 0.8462009 0.2689410
4 1.054746 1.112490 0.8592683 0.2673023
5 1.056818 1.116864 0.8620348 0.2674363
6 1.056963 1.117170 0.8571898 0.2725451

[15 rows x 6 columns] </code></pre>
<p><code>Print of the scoring history</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">h2o.scoreHistory</span>(h2oamlmodel2<span class="op">@</span>leader)</code></pre></div>
<pre><code>Scoring History: 
             timestamp          duration number_of_trees training_rmse
1  2019-04-24 15:56:44  4 min 43.962 sec               0            NA
2  2019-04-24 15:56:45  4 min 44.868 sec               1       1.04531
3  2019-04-24 15:56:46  4 min 46.496 sec               2       1.01972
4  2019-04-24 15:56:48  4 min 47.738 sec               3       1.02279
5  2019-04-24 15:56:52  4 min 52.322 sec               7       1.02390
6  2019-04-24 15:56:57  4 min 56.892 sec              10       1.01407
7  2019-04-24 15:57:01  5 min  1.097 sec              14       1.01350
8  2019-04-24 15:57:06  5 min  5.648 sec              18       1.01059
9  2019-04-24 15:57:11  5 min 10.711 sec              22       1.00790
10 2019-04-24 15:57:15  5 min 15.087 sec              25       1.00708
11 2019-04-24 15:57:19  5 min 19.196 sec              30       1.00855
12 2019-04-24 15:57:24  5 min 23.735 sec              33       1.00705
   training_mae training_deviance
1            NA                NA
2       0.84292           1.09268
3       0.81434           1.03983
4       0.81802           1.04610
5       0.82144           1.04838
6       0.81201           1.02834
7       0.81177           1.02718
8       0.80910           1.02129
9       0.80635           1.01587
10      0.80546           1.01422
11      0.80753           1.01717
12      0.80580           1.01414
 [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 4 rows ]</code></pre>
<p><code>Plot of the training history, metric (rmse)</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(h2oamlmodel2<span class="op">@</span>leader, <span class="dt">timestep =</span> <span class="st">&quot;number_of_trees&quot;</span>, <span class="dt">metric =</span> <span class="st">&quot;rmse&quot;</span>)</code></pre></div>
<p><img src="HTML__MINE_files/figure-html/unnamed-chunk-52-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>Plot of the variables Importance (by order)</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">h2o.varimp_plot</span>(h2oamlmodel2<span class="op">@</span>leader, <span class="dt">num_of_features =</span> <span class="ot">NULL</span>)</code></pre></div>
<p><img src="HTML__MINE_files/figure-html/unnamed-chunk-53-1.png" width="576" style="display: block; margin: auto;" /></p>
<strong>Root mean squared error of H2o Auto ML algorithm</strong>
<table class="table table-bordered" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Algorithm
</th>
<th style="text-align:right;">
RMSE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
Matrix factorization with SGD
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
0.7829978
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o Auto ML model2
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0382518
</td>
</tr>
</tbody>
</table>
</div>
<div id="h2o-generalized-linear-models-glm" class="section level1">
<h1>H2o Generalized Linear Models (GLM)</h1>
<p><br> <br> <strong>Because on autoML we cant tune many hyperparameters</strong>, we will also try on other models with various hyper tunings.Then <strong>we will stack those different models stacked ensemble</strong>.<br />
<br/></p>
<p>Ensemble machine learning methods use<strong>multiple learning algorithms to obtain better predictive </strong>performance than could be obtained from any of the constituent learning algorithms We start with:<br />
<br/></p>
<p>-Generalized Linear Models (GLM) estimate regression models for outcomes following exponential distributions. In addition to the Gaussian (i.e. normal) distribution, these include<br />
<br/></p>
<p><strong>-Poisson</strong> <br/></p>
<p><strong>-binomial and</strong> <br/></p>
<p><strong>-gamma distributions</strong> (<a href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/glm.html" class="uri">http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/glm.html</a>) <br/> <code>H2o GLM hyperparameters 0=ridge , 1 = lasso, so we leave it in the middle to use both penalizers</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">h2o_glm &lt;-<span class="st"> </span><span class="kw">h2o.glm</span>( <span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;movieId&quot;</span>,<span class="st">&quot;userId&quot;</span>,<span class="st">&quot;n.users_bymovie&quot;</span>,<span class="st">&quot;Drama&quot;</span>,<span class="st">&quot;age_of_movie&quot;</span>,<span class="st">&quot;Comedy&quot;</span>),  
                    <span class="dt">y =</span> <span class="st">&quot;rating&quot;</span> ,   
                    <span class="dt">training_frame =</span> train3 ,  
                    <span class="dt">validation_frame =</span> test3,  
                    <span class="dt">alpha =</span> <span class="fl">0.5</span>,   <span class="co">#0=ridge , 1 = lasso, so we leave it in the middle to use both   </span>
                    <span class="dt">lambda =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.25</span>),  
                    <span class="dt">nlambdas =</span> <span class="dv">30</span>,  
                    <span class="dt">seed =</span> <span class="dv">1</span>,  
                    <span class="dt">keep_cross_validation_predictions =</span> <span class="ot">TRUE</span>,  
                    <span class="dt">nfolds =</span> <span class="dv">3</span>)  </code></pre></div>
<p>output - Standardized Coefficient Magnitudes (standardized coefficient magnitudes)<br />
-movieId<br />
-userId<br />
-age_of_movie<br />
<br/></p>
<p><code>summary(h2o_glm)</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(h2o_glm)</code></pre></div>
<pre><code>Model Details:
==============

H2ORegressionModel: glm
Model Key:  GLM_model_R_1555942382794_38 
GLM Model: summary
    family     link                           regularization
1 gaussian identity Elastic Net (alpha = 0.5, lambda = 0.0 )
  number_of_predictors_total number_of_active_predictors
1                      80648                       80578
  number_of_iterations   training_frame
1                   50 RTMP_sid_9155_88

H2ORegressionMetrics: glm
** Reported on training data. **

MSE:  0.8456564
RMSE:  0.9195958
MAE:  0.7172375
RMSLE:  0.2437822
Mean Residual Deviance :  0.8456564
R^2 :  0.2479454
Null Deviance :7084475
Null D.o.F. :6300326
Residual Deviance :5327912
Residual D.o.F. :6219748
AIC :16984513


H2ORegressionMetrics: glm
** Reported on validation data. **

MSE:  0.8500083
RMSE:  0.9219589
MAE:  0.7187125
RMSLE:  0.2443887
Mean Residual Deviance :  0.8500083
R^2 :  0.243719
Null Deviance :3034302
Null D.o.F. :2699720
Residual Deviance :2294785
Residual D.o.F. :2619142
AIC :7383907


H2ORegressionMetrics: glm
** Reported on cross-validation data. **
** 3-fold cross-validation on training data (Metrics computed for combined holdout predictions) **

MSE:  0.8432479
RMSE:  0.9182853
MAE:  0.7153296
RMSLE:  0.2434671
Mean Residual Deviance :  0.8432479
R^2 :  0.2500874
Null Deviance :7084481
Null D.o.F. :6300326
Residual Deviance :5312737
Residual D.o.F. :6219832
AIC :16966375


Cross-Validation Metrics Summary: 
                             mean           sd cv_1_valid cv_2_valid
mae                     0.7153301 8.4168854E-4   0.713684  0.7164582
mean_residual_deviance 0.84324986 0.0015927338  0.8402663  0.8437752
mse                    0.84324986 0.0015927338  0.8402663  0.8437752
null_deviance           2361493.8    1591.0111  2358487.2  2363899.5
r2                      0.2500874 5.5939064E-4 0.25109872 0.24999613
residual_deviance       1770912.4    2327.2556  1766270.8  1772933.8
rmse                   0.91828555   8.67428E-4 0.91666037 0.91857237
rmsle                  0.24346721 2.9301652E-4 0.24303728 0.24333727
                       cv_3_valid
mae                     0.7158482
mean_residual_deviance 0.84570813
mse                    0.84570813
null_deviance           2362094.2
r2                      0.2491674
residual_deviance       1773532.8
rmse                    0.9196239
rmsle                  0.24402706

Scoring History: 
            timestamp   duration iterations negative_log_likelihood
1 2019-04-24 21:36:36  0.000 sec          0           7084475.04044
2 2019-04-24 21:36:36  0.203 sec          1           6791137.50291
3 2019-04-24 21:36:36  0.438 sec          2           6672861.94944
4 2019-04-24 21:36:36  0.653 sec          3           6649442.26266
5 2019-04-24 21:36:37  0.853 sec          4           6569032.76605
  objective
1   1.12446
2   1.07790
3   1.05913
4   1.05541
5   1.04265

---
             timestamp   duration iterations negative_log_likelihood
46 2019-04-24 21:36:58 21.867 sec         45           5394055.33858
47 2019-04-24 21:36:58 22.074 sec         46           5378878.06715
48 2019-04-24 21:36:58 22.274 sec         47           5368760.04431
49 2019-04-24 21:36:58 22.496 sec         48           5351761.62870
50 2019-04-24 21:36:59 23.315 sec         49           5347649.79277
51 2019-04-24 21:36:59 23.522 sec         50           5327911.81262
   objective
46   0.85615
47   0.85375
48   0.85214
49   0.84944
50   0.84879
51   0.84566

Variable Importances: (Extract with `h2o.varimp`) 
=================================================

Standardized Coefficient Magnitudes: standardized coefficient magnitudes
         names coefficients sign
1  movieId.193     1.771044  NEG
2 movieId.3593     1.740096  NEG
3 userId.30272     1.728364  NEG
4  movieId.720     1.684223  POS
5 movieId.2422     1.603026  NEG

---
             names coefficients sign
80644 movieId.7537     0.000000  POS
80645 movieId.7568     0.000000  POS
80646 movieId.7750     0.000000  POS
80647 movieId.8038     0.000000  POS
80648 movieId.8148     0.000000  POS
80649                        NA   NA</code></pre>
<strong>RMSE H2o GLM algorithm</strong>
<table class="table table-bordered" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Algorithm
</th>
<th style="text-align:right;">
RMSE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
Matrix factorization with SGD
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
0.7829978
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o Auto ML model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0382518
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o GLM model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0163097
</td>
</tr>
</tbody>
</table>
</div>
<div id="h2o---gradient-boosting-machine-model" class="section level1">
<h1>H2o - Gradient Boosting Machine model</h1>
<p><br> <br> <strong>Gradient Boosting Machine (for Regression and Classification) is a forward learning ensemble method. The guiding</strong> <strong>heuristic is that good predictive results can be obtained through</strong> <strong>increasingly refined approximations. H2O’s GBM sequentially builds regression trees on all the features of the</strong> <strong>dataset in a fully distributed way - each tree is built in parallel.</strong> (<a href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/gbm.html" class="uri">http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/gbm.html</a>) <br/></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">h2o_gbm_model &lt;-<span class="st"> </span><span class="kw">h2o.gbm</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;movieId&quot;</span>, <span class="st">&quot;userId&quot;</span>, <span class="st">&quot;n.movies_byUser&quot;</span>, <span class="st">&quot;n.users_bymovie&quot;</span>, 
    <span class="st">&quot;Drama&quot;</span>, <span class="st">&quot;Comedy&quot;</span>, <span class="st">&quot;age_of_movie&quot;</span>), <span class="dt">y =</span> <span class="st">&quot;rating&quot;</span>, <span class="dt">training_frame =</span> train3, 
    <span class="dt">ntrees =</span> <span class="dv">50</span>, <span class="dt">validation_frame =</span> test3, <span class="dt">nfolds =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">1</span>, <span class="dt">keep_cross_validation_predictions =</span> <span class="ot">TRUE</span>, 
    <span class="dt">fold_assignment =</span> <span class="st">&quot;AUTO&quot;</span>)</code></pre></div>
<p><code>Plot scoring history</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(h2o_gbm_model)</code></pre></div>
<p><img src="HTML__MINE_files/figure-html/unnamed-chunk-61-1.png" width="576" style="display: block; margin: auto;" /> <code>Plot the variables importance</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">h2o.varimp_plot</span>(h2o_gbm_model, <span class="dt">num_of_features =</span> <span class="ot">NULL</span>)</code></pre></div>
<p><img src="HTML__MINE_files/figure-html/unnamed-chunk-62-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>Print the scoring history</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">h2o.scoreHistory</span>(h2o_gbm_model)</code></pre></div>
<pre><code>Scoring History: 
            timestamp          duration number_of_trees training_rmse
1 2019-04-24 21:30:32  2 min 32.011 sec               0       1.06041
2 2019-04-24 21:30:33  2 min 33.057 sec               1       1.05020
3 2019-04-24 21:30:35  2 min 35.116 sec               2       1.04137
4 2019-04-24 21:30:40  2 min 39.933 sec               9       1.00783
5 2019-04-24 21:30:50  2 min 50.090 sec              24       0.98933
6 2019-04-24 21:31:08  3 min  7.809 sec              50       0.97746
  training_mae training_deviance validation_rmse validation_mae
1      0.85561           1.12446         1.06016        0.85539
2      0.84784           1.10293         1.05000        0.84765
3      0.84121           1.08444         1.04120        0.84105
4      0.80780           1.01572         1.00785        0.80779
5      0.78449           0.97877         0.98954        0.78462
6      0.77237           0.95543         0.97786        0.77263
  validation_deviance
1             1.12393
2             1.10249
3             1.08410
4             1.01577
5             0.97918
6             0.95621</code></pre>
<p><code>Root mean squared error calculation</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">h2o.performance</span>(h2o_gbm_model, test3)
pred.ratings.h2o_gbm_model &lt;-<span class="st"> </span><span class="kw">h2o.predict</span>(h2o_gbm_model, <span class="kw">as.h2o</span>(test_validation))
rmse_of_model_h2o_gbm_model &lt;-<span class="st"> </span><span class="kw">RMSE</span>(pred.ratings.h2o_gbm_model, <span class="kw">as.h2o</span>(test_validation<span class="op">$</span>rating))</code></pre></div>
<strong>Root mean squared error of H2o GBM model</strong>
<table class="table table-bordered" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Algorithm
</th>
<th style="text-align:right;">
RMSE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
Matrix factorization with SGD
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
0.7829978
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o Auto ML model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0382518
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o GLM model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0163097
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o GBM model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0353257
</td>
</tr>
</tbody>
</table>
</div>
<div id="h2o-distributed-random-forest" class="section level1">
<h1>H2o Distributed Random Forest</h1>
<p><br> <br> <strong>Distributed Random Forest (DRF) is a powerful classification and regression tool. When </strong><br />
<strong>given a set of data, DRF generates a forest of classification (or regression) trees, rather</strong><br />
** than a single classification (or regression) tree. Each of these trees is a weak learner built **<br />
<strong>on a subset of rows and columns</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">h2orf1 &lt;-<span class="st"> </span><span class="kw">h2o.randomForest</span>( <span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;movieId&quot;</span>,<span class="st">&quot;userId&quot;</span>,<span class="st">&quot;n.movies_byUser&quot;</span>,<span class="st">&quot;n.users_bymovie&quot;</span>,<span class="st">&quot;Drama&quot;</span>,  
                                  <span class="st">&quot;Comedy&quot;</span>,<span class="st">&quot;age_of_movie&quot;</span>,<span class="st">&quot;year_rated&quot;</span>) ,    
                            <span class="dt">y =</span> <span class="st">&quot;rating&quot;</span> ,         <span class="co"># Dependent var  </span>
                            <span class="dt">training_frame =</span> train3,        ## the H2O frame for training  
                            <span class="dt">validation_frame =</span> test3, <span class="co"># the testing frame NOT the real validation!!  </span>
                            <span class="dt">model_id =</span> <span class="st">&quot;h2orf1&quot;</span>,    ## name the model ID so you can load it afterwards   in R and in h2o  
                            <span class="dt">ntrees =</span> <span class="dv">50</span>,                  ## numb of  maximum trees to use.The default   is 50  
                            <span class="dt">max_depth =</span> <span class="dv">30</span>,  
                            <span class="dt">keep_cross_validation_predictions=</span> <span class="ot">TRUE</span>, <span class="co"># i recommend to use cross   validation  </span>
                            <span class="dt">min_rows =</span> <span class="dv">100</span>, <span class="co"># min rows during training,you can add the early stopping criteria decide when to stop fitting new trees</span>
                            <span class="dt">score_each_iteration =</span> T,      ## Predict against training and validation   for each tree. Default will skip several.  
                            <span class="dt">nfolds =</span> <span class="dv">3</span>,  
                            <span class="dt">fold_assignment =</span> <span class="st">&quot;AUTO&quot;</span>,  
                            <span class="dt">seed =</span> <span class="dv">1</span>)   </code></pre></div>
<p><code>Plot variables importance</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">h2o.varimp_plot</span>(h2orf1, <span class="dt">num_of_features =</span> <span class="ot">NULL</span>)</code></pre></div>
<p><img src="HTML__MINE_files/figure-html/unnamed-chunk-68-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>The variable importance</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">h2o.varimp_plot</span>(h2orf1, <span class="dt">num_of_features =</span> <span class="ot">NULL</span>)</code></pre></div>
<p><img src="HTML__MINE_files/figure-html/unnamed-chunk-69-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>The scoring history of h2orf1</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">h2o.scoreHistory</span>(h2orf1)</code></pre></div>
<pre><code>Scoring History: 
            timestamp          duration number_of_trees training_rmse
1 2019-04-22 20:28:56 25 min 48.392 sec               0            NA
2 2019-04-22 20:29:00 25 min 52.347 sec               1       0.95437
3 2019-04-22 20:29:04 25 min 56.322 sec               2       0.95141
4 2019-04-22 20:29:08 26 min  0.384 sec               3       0.94985
5 2019-04-22 20:29:12 26 min  4.251 sec               4       0.94858
  training_mae training_deviance
1           NA                NA
2      0.74891           0.91081
3      0.74656           0.90518
4      0.74548           0.90221
5      0.74441           0.89981

---
             timestamp          duration number_of_trees training_rmse
46 2019-04-22 20:31:55 28 min 46.636 sec              45       0.93905
47 2019-04-22 20:31:59 28 min 50.840 sec              46       0.93903
48 2019-04-22 20:32:03 28 min 54.761 sec              47       0.93900
49 2019-04-22 20:32:07 28 min 58.739 sec              48       0.93900
50 2019-04-22 20:32:11 29 min  2.568 sec              49       0.93898
51 2019-04-22 20:32:14 29 min  6.439 sec              50       0.93898
   training_mae training_deviance
46      0.73704           0.88181
47      0.73702           0.88179
48      0.73699           0.88172
49      0.73699           0.88171
50      0.73697           0.88169
51      0.73697           0.88167</code></pre>
<strong>Root mean squared error of h2orf1_model</strong>
<table class="table table-bordered" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Algorithm
</th>
<th style="text-align:right;">
RMSE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
Matrix factorization with SGD
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
0.7829978
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o Auto ML model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0382518
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o GLM model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0163097
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o GBM model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0353257
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o RF model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0295050
</td>
</tr>
</tbody>
</table>
</div>
<div id="h2o-stacked-ensembles" class="section level1">
<h1>H2o Stacked Ensembles</h1>
<p><br> <br> Ensemble machine learning methods use <strong>multiple learning algorithms </strong> to obtain better predictive performance than could be obtained from any of the <strong>constituent learning algorithms </strong>. H2O’s Stacked Ensemble method is <strong>supervised ensemble machine learning algorithm </strong> that finds the optimal combination of a collection of prediction algorithms using a process called stacking. This method currently supports regression and binary classification. Stacking, also called Super Learning or Stacked Regression, is a class of algorithms that involves training a <strong>second-level “metalearner” </strong> to find the optimal combination of the base learners. Unlike bagging and boosting, the goal in stacking is to ensemble <strong>strong, diverse sets of learners together. </strong><br />
<br/><br />
(<a href="https://h2o-release.s3.amazonaws.com/h2o/rel-ueno/2/docs-website/h2o-docs/data-science/stacked-ensembles.html" class="uri">https://h2o-release.s3.amazonaws.com/h2o/rel-ueno/2/docs-website/h2o-docs/data-science/stacked-ensembles.html</a>)</p>
<p>We will stack the previous 3 models:<br />
<br/> -Generalized Linear Models<br />
-Gradient Boosting Machine and the<br />
-Distributed Random Forest (h2o_glm, h2o_gbm_model, h2orf_model)<br />
<br/></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">h2oensemble2 &lt;-<span class="st"> </span><span class="kw">h2o.stackedEnsemble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;movieId&quot;</span>, <span class="st">&quot;userId&quot;</span>, <span class="st">&quot;n.movies_byUser&quot;</span>, 
    <span class="st">&quot;n.users_bymovie&quot;</span>, <span class="st">&quot;Drama&quot;</span>, <span class="st">&quot;Comedy&quot;</span>, <span class="st">&quot;age_of_movie&quot;</span>), <span class="dt">y =</span> <span class="st">&quot;rating&quot;</span>, <span class="dt">training_frame =</span> train3, 
    <span class="dt">validation_frame =</span> test3, <span class="dt">model_id =</span> <span class="st">&quot;h2oensemble2&quot;</span>, <span class="dt">seed =</span> <span class="dv">1</span>, <span class="dt">base_models =</span> <span class="kw">list</span>(h2o_glm, 
        h2o_gbm_model, h2orf1))</code></pre></div>
<p>-Algorithm: Stacked Ensemble<br />
-Model ID: h2oensemble2<br />
<br/></p>
</div>
<div id="root-mean-squared-error-of-all-models" class="section level1">
<h1>Root mean squared error of all models</h1>
<br> <br>
<table class="table table-bordered" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
methods
</th>
<th style="text-align:right;">
rmse
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
Matrix factorization with SGD
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
0.7829978
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o Auto ML model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0382518
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o GLM model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0163097
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o GBM model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0353257
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o RF model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0295050
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
H2o Ensemble model
</td>
<td style="text-align:right;font-weight: bold;color: red !important;background-color: lightgrey !important;">
1.0036833
</td>
</tr>
</tbody>
</table>
</div>
<div id="conclusions" class="section level1">
<h1>Conclusions</h1>
<p><br> <br> The lowest RMSE suprisingly was achieved only with <strong>2 Features : user ID and Movie ID</strong> in Matrix factorization with SGD (RMSE 0.78). <strong>Newral Networks algorithms are extremely slow and demanding on computation (even only with 2 newrons and 2 features)</strong>. They needed more than 8 hours! If you need them please ask and i will send you the trained models<br />
<br/> I have also <strong>run the algorithms on CUDA where i show significantly speed improvement</strong> comparing with my above algorithms. I would definitely recommended it.<br />
<br/> <strong>H2o XGBoost algorithm runs ONLY IN LINUX</strong><br />
The second lowest was the h2o ensemble model (RMSE 1.003) which stacked the below models</p>
<p>-(GLM,GBM,DRF)</p>
<p>With more hyper parameters tuning even lower RMSE can be achieved. But not so low like with MF models.</p>
<p>I wouldn’t recommend the auto ML model seems you can’t tune the hyper parameters of the models, that results not into the lowest RMSE or higher accuracy on classification models.</p>
<p>I also trained the same models with <strong>scaled values but the RMSE was in all models higher</strong>. It seems that the most important features where:</p>
<p>-Number of users rated the movie<br />
-age of movie = more ratings and higher mean rating<br />
-the movie id and<br />
-Drama = (genre with the most ratings)</p>
<p>The other features didn’t had low p value and didn’t improve the model efficiency but the overfitted it.</p>
<p><strong>In H2o Auto ML model (RMSE 1.03)</strong> the most important features where the below OUTPUT - VARIABLE IMPORTANCES<br />
-variable relative_importance scaled_importance percentage<br />
-n.users_bymovie 7164049.0 1.0 0.3019<br />
-Drama 5418105.0 0.7563 0.2283<br />
-movieId 5250999.0 0.7330 0.2212</p>
<p><strong>The GLM Model (RMSE 1.01 )</strong> has similar evaluation process with Matrix factorization with SGD. Thats why put more weight on the below features<br />
output - Standardized Coefficient Magnitudes (standardized coefficient magnitudes)</p>
<p>-movieId<br />
-userId<br />
-age_of_movie<br />
-But the RMSE 1.01 was not so low like MF model.</p>
<p><strong>The Gradient Boosting Machine Model (RMSE 1.03)</strong> put more weight on the below features<br />
-variable relative_importance scaled_importance percentage<br />
-age_of_movie 1759746.6250 1.0 0.3140<br />
-n.users_bymovie 1684104.0 0.9570 0.3005<br />
-movieId 883807.2500 0.5022 0.1577</p>
<p><strong>The distributed Random Forest Model (RMSE 1.02) put more weight on the below features</strong></p>
<p>-variable relative_importance scaled_importance percentage<br />
-n.users_bymovie 26496842.0 1.0 0.2790<br />
-age_of_movie 22493868.0 0.8489 0.2369<br />
-movieId 21997428.0 0.8302 0.2317<br />
-Drama 9633707.0 0.3636 0.1015</p>
<p>The <strong>h2o ensemble model (RMSE 1.003)</strong> stacked the below 3 models:</p>
<p>-GLM<br />
-GBM<br />
-DRF</p>
<p>And had significant the lowest RMSE of the H2o Models.<br />
<strong>With more hyper parameters tuning even lower RMSE can be achieved</strong>. But not so low like with MF models.</p>
</div>
<div id="recommendations" class="section level1">
<h1>Recommendations</h1>
<p>With web scraping we could add more dimensions into our datasets such us:<br />
<br/> <strong>-budget of movie </strong> <br/> <strong>-critics rating and </strong> <br/> <strong>-duration of movie and compare the RMSE’s</strong> <br/> <strong>I wouldn’t recommend the auto ML model</strong> seems you can’t tune the hyper parameters of the models and that results not into the optimal model. <br/> <em>Thank you for reading my analysis.</em> <br/> KR<br />
Niko <br/> # Contact</p>
<p>@(<a href="https://www.linkedin.com/in/niko-papacosmas-mba-pmp-mcse-695a2695/" class="uri">https://www.linkedin.com/in/niko-papacosmas-mba-pmp-mcse-695a2695/</a>)</p>
</div>

    </div>
    <div class="col-xs-2">
        <div class="btn-toolbar">
    <div class="btn-group">
    <a href="#" class="btn btn-raised btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="text-muted">Code</span> <span class="text-muted caret"></span></a>
    <ul class="dropdown-menu" style="min-width: 50px;">
    <li><a id="rmd-show-all-code" href="#">Show All</a></li>
    <li><a id="rmd-hide-all-code" href="#">Hide All</a></li>
    </ul>
    </div>
    </div>
        </div>
  </div>
  </div>
  </div>
  <div class="row">
    </div>
  </div>

<script>
$(document).ready(function () {
  // add bootstrap table styles to pandoc tables
  $('tr.header').parent('thead').parent('table').addClass('table table-striped table-hover');

    var images = $('.pages img');
  images.filter(function() {
      if ($(this).parent().attr("class") == "figure") {
          return(false)
      } else {
          return(true);
      }
  }).wrap("<div class='figure'></div>");
  images.addClass("image-thumb").wrap("<div class='panel-body'></div>");
  $('.figure p.caption').wrap("<div class='panel-footer'></div>");
  $('.figure').addClass('panel panel-default');
  
    $('.pages img')
 	  .addClass("image-lb");
  $('.pages').magnificPopup({
	      type:'image',
	      closeOnContentClick: false,
	      closeBtnInside: false,
        delegate: 'img',
	      gallery: {enabled: false },
          removalDelay: 500,
          callbacks: {
              beforeOpen: function() {
                // just a hack that adds mfp-anim class to markup
                this.st.image.markup = this.st.image.markup.replace('mfp-figure', 'mfp-figure mfp-with-anim');
              }
          },
          mainClass: 'mfp-move-from-top',
	      image: {
	        verticalFit: true,
            titleSrc: 'alt'
	      }
 	    });
 	
    
    $(".page").addClass("active");
    $('.pages').scrollspy({target: '#toc'});

    


    window.page = window.location.hash;
    if (window.page != "") {
      $(".menu").find("li[data-target=" + window.page + "]").trigger("click");
    }

    /* init material bootstrap js */
    $.material.init();
});
</script>




<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
